<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-10-09 Sun 18:20 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Luke Yao" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<!-- HTML -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css">
<script src="/ox-html.js"></script>
<link rel="stylesheet" href="/ox-html.css">
</head>
<body>
<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label><div id="content">
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orge46d68e">1. Dependencies</a></li>
<li><a href="#orgacc949e">2. Properties</a></li>
<li><a href="#org878e90d">3. Config Bean</a></li>
<li><a href="#org2bd88fd">4. Index Management</a></li>
<li><a href="#orgd657810">5. Doc Management</a></li>
</ul>
</div>
</nav>
<p>
SpringBoot 连接 ElasticSearch，主流的 有以下四种
</p>

<ul class="org-ul">
<li>通过Elastic Transport Client客户端连接 es 服务器，底层基于 TCP 协议通过 transport 模块和远程 ES 服务端通信，不过，从 V7.0 开始官方不建议使用，V8.0开始正式移除。</li>

<li>通过Elastic Java Low Level Rest Client客户端连接 es 服务器，底层基于 HTTP 协议通过 restful API 来和远程 ES 服务端通信，只提供了最简单最基本的 API，类似于上篇文章中给大家介绍的 API 操作逻辑。</li>

<li>通过Elastic Java High Level Rest Client客户端连接 es 服务器，底层基于Elastic Java Low Level Rest Client客户端做了一层封装，提供了更高级得 API 且和Elastic Transport Client接口及参数保持一致，官方推荐的 es 客户端。</li>

<li>通过JestClient客户端连接 es 服务器，这是开源社区基于 HTTP 协议开发的一款 es 客户端，官方宣称接口及代码设计比 ES 官方提供的 Rest 客户端更简洁、更合理，更好用，具有一定的 ES 服务端版本兼容性，但是更新速度不是很快，目前 ES 版本已经出到 V7.9，但是JestClient只支持 V1.0~V6.X 版 本的 ES。</li>
</ul>

<p>
还有一个需要大家注意的地方，那就是版本号的兼容! 在开发过程中，大家尤其需要关注一下客户端和服务端的版本号，要尽可能保持一致，比如服务端 es 的版本号是6.8.2，那么连接 es 的客户端版本号，最好也是6.8.2，即使因项目的原因不能保持一致，客户端的版本号必须在6.0.0 ～6.8.2，不要超过服务器的版本号，这样客户端才能保持正常工作，否则会出现很多意想不到的问题，假如客户端是7.0.4的版本号，此时的程序会各种报错，甚至没办法用!
</p>

<p>
为什么要这样做呢?主要原因就是 es 的服务端，高版本不兼容低版本;es6 和 es7 的某些 API 请求参数结构有着很大的区别，所以客户端和服务端版本号尽量保持一致。
</p>

<div id="outline-container-orge46d68e" class="outline-2">
<h2 id="orge46d68e"><span class="section-number-2">1.</span> Dependencies</h2>
<div class="outline-text-2" id="text-1">
<details id='org3214388' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org3214388'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">elasticsearch</span><span class="org-comment-delimiter">--&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">org.elasticsearch</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">elasticsearch</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">6.4.2</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">org.elasticsearch.client</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">elasticsearch-rest-client</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">6.4.2</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">org.elasticsearch.client</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">groupId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">elasticsearch-rest-high-level-client</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">artifactId</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">6.4.2</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">version</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">dependency</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>
</div>
</div>

<div id="outline-container-orgacc949e" class="outline-2">
<h2 id="orgacc949e"><span class="section-number-2">2.</span> Properties</h2>
<div class="outline-text-2" id="text-2">
<details id='org959dcb3' class='code' open><summary><span class="lang">Configuration File</span></summary>
        <div class='gutter'>
        <a href='#org959dcb3'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-conf"><span class="org-variable-name">elasticsearch.scheme</span>=http
<span class="org-variable-name">elasticsearch.address</span>=127.0.0.1:<span class="org-highlight-numbers-number">9200</span>
<span class="org-variable-name">elasticsearch.userName</span>=
<span class="org-variable-name">elasticsearch.userPwd</span>=
<span class="org-variable-name">elasticsearch.socketTimeout</span>=<span class="org-highlight-numbers-number">5000</span>
<span class="org-variable-name">elasticsearch.connectTimeout</span>=<span class="org-highlight-numbers-number">5000</span>
<span class="org-variable-name">elasticsearch.connectionRequestTimeout</span>=<span class="org-highlight-numbers-number">5000</span>
</pre>
</div>
        </details>
</div>
</div>

<div id="outline-container-org878e90d" class="outline-2">
<h2 id="org878e90d"><span class="section-number-2">3.</span> Config Bean</h2>
<div class="outline-text-2" id="text-3">
<details id='orgad054a2' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgad054a2'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Configuration</span>
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">ElasticsearchConfiguration</span> {

    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">Logger</span> <span class="org-variable-name">log</span> = LoggerFactory.getLogger(ElasticsearchConfiguration.<span class="org-keyword">class</span>);


    <span class="org-keyword">private</span> <span class="org-keyword">static</span> <span class="org-keyword">final</span> <span class="org-type">int</span> <span class="org-variable-name">ADDRESS_LENGTH</span> = <span class="org-highlight-numbers-number">2</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.scheme:http}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">scheme</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.address}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">address</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.userName}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">userName</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.userPwd}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">userPwd</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.socketTimeout:5000}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">Integer</span> <span class="org-variable-name">socketTimeout</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.connectTimeout:5000}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">Integer</span> <span class="org-variable-name">connectTimeout</span>;

    <span class="org-c-annotation">@Value</span>(<span class="org-string">"${elasticsearch.connectionRequestTimeout:5000}"</span>)
    <span class="org-keyword">private</span> <span class="org-type">Integer</span> <span class="org-variable-name">connectionRequestTimeout</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#21021;&#22987;&#21270;&#23458;&#25143;&#31471;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@return</span></span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Bean</span>(name = <span class="org-string">"restHighLevelClient"</span>)
    <span class="org-keyword">public</span> <span class="org-type">RestHighLevelClient</span> <span class="org-function-name">restClientBuilder</span>() {
        <span class="org-type">HttpHost</span>[] <span class="org-variable-name">hosts</span> = Arrays.stream(address.split(<span class="org-string">","</span>))
                .map(<span class="org-keyword">this</span>::buildHttpHost)
                .filter(Objects::nonNull)
                .toArray(HttpHost[]::<span class="org-keyword">new</span>);
        <span class="org-type">RestClientBuilder</span> <span class="org-variable-name">restClientBuilder</span> = RestClient.builder(hosts);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#24322;&#27493;&#21442;&#25968;&#37197;&#32622;</span>
        restClientBuilder.setHttpClientConfigCallback(httpClientBuilder -&gt; {
            httpClientBuilder.setDefaultCredentialsProvider(buildCredentialsProvider());
            <span class="org-keyword">return</span> httpClientBuilder;
        });

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#24322;&#27493;&#36830;&#25509;&#24310;&#26102;&#37197;&#32622;</span>
        restClientBuilder.setRequestConfigCallback(requestConfigBuilder -&gt; {
            requestConfigBuilder.setConnectionRequestTimeout(connectionRequestTimeout);
            requestConfigBuilder.setSocketTimeout(socketTimeout);
            requestConfigBuilder.setConnectTimeout(connectTimeout);
            <span class="org-keyword">return</span> requestConfigBuilder;
        });

        <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">RestHighLevelClient</span>(restClientBuilder);
    }


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26681;&#25454;&#37197;&#32622;&#21019;&#24314;HttpHost</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@param</span></span><span class="org-doc"> s</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@return</span></span>
<span class="org-doc">     */</span>
    <span class="org-keyword">private</span> <span class="org-type">HttpHost</span> <span class="org-function-name">buildHttpHost</span>(<span class="org-type">String</span> <span class="org-variable-name">s</span>) {
        <span class="org-type">String</span>[] <span class="org-variable-name">address</span> = s.split(<span class="org-string">":"</span>);
        <span class="org-keyword">if</span> (address.length == ADDRESS_LENGTH) {
            <span class="org-type">String</span> <span class="org-variable-name">ip</span> = address[<span class="org-highlight-numbers-number">0</span>];
            <span class="org-type">int</span> <span class="org-variable-name">port</span> = Integer.parseInt(address[<span class="org-highlight-numbers-number">1</span>]);
            <span class="org-keyword">return</span> <span class="org-keyword">new</span> <span class="org-type">HttpHost</span>(ip, port, scheme);
        } <span class="org-keyword">else</span> {
            <span class="org-keyword">return</span> <span class="org-constant">null</span>;
        }
    }

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26500;&#24314;&#35748;&#35777;&#26381;&#21153;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@return</span></span>
<span class="org-doc">     */</span>
    <span class="org-keyword">private</span> <span class="org-type">CredentialsProvider</span> <span class="org-function-name">buildCredentialsProvider</span>(){
        <span class="org-keyword">final</span> <span class="org-type">CredentialsProvider</span> <span class="org-variable-name">credentialsProvider</span> = <span class="org-keyword">new</span> <span class="org-type">BasicCredentialsProvider</span>();
        credentialsProvider.setCredentials(<span class="org-constant">AuthScope</span>.ANY, <span class="org-keyword">new</span> <span class="org-type">UsernamePasswordCredentials</span>(userName,
                userPwd));
        <span class="org-keyword">return</span> credentialsProvider;
    }
}
</pre>
</div>
        </details>
</div>
</div>

<div id="outline-container-org2bd88fd" class="outline-2">
<h2 id="org2bd88fd"><span class="section-number-2">4.</span> Index Management</h2>
<div class="outline-text-2" id="text-4">
<ol class="org-ol">
<li><p>
create
</p>

<details id='org9a4a2e0' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org9a4a2e0'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#21019;&#24314;&#32034;&#24341;&#65288;&#31616;&#21333;&#27169;&#24335;&#65289;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">createIndex</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">CreateIndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">CreateIndexRequest</span>(<span class="org-string">"cs_index"</span>);
        <span class="org-type">CreateIndexResponse</span> <span class="org-variable-name">response</span> = client.indices().create(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.isAcknowledged());
    }


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#21019;&#24314;&#32034;&#24341;&#65288;&#22797;&#26434;&#27169;&#24335;&#65289;</span>
<span class="org-doc">     * &#21487;&#20197;&#30452;&#25509;&#25226;&#23545;&#24212;&#30340;&#25991;&#26723;&#32467;&#26500;&#20063;&#19968;&#24182;&#21021;&#22987;&#21270;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">createIndexComplete</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">CreateIndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">CreateIndexRequest</span>();
        <span class="org-comment-delimiter">//</span><span class="org-comment">&#32034;&#24341;&#21517;&#31216;</span>
        request.index(<span class="org-string">"cs_index"</span>);
        <span class="org-comment-delimiter">//</span><span class="org-comment">&#32034;&#24341;&#37197;&#32622;</span>
        <span class="org-type">Settings</span> <span class="org-variable-name">settings</span> = Settings.builder()
                .put(<span class="org-string">"index.number_of_shards"</span>, <span class="org-highlight-numbers-number">3</span>)
                .put(<span class="org-string">"index.number_of_replicas"</span>, <span class="org-highlight-numbers-number">1</span>)
                .build();
        request.settings(settings);

        <span class="org-comment-delimiter">//</span><span class="org-comment">&#26144;&#23556;&#32467;&#26500;&#23383;&#27573;</span>
        <span class="org-type">Map</span>&lt;<span class="org-type">String</span>, <span class="org-type">Object</span>&gt; <span class="org-variable-name">properties</span> = <span class="org-keyword">new</span> <span class="org-type">HashMap</span>();
        properties.put(<span class="org-string">"id"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"text"</span>));
        properties.put(<span class="org-string">"name"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"text"</span>));
        properties.put(<span class="org-string">"sex"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"text"</span>));
        properties.put(<span class="org-string">"age"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"long"</span>));
        properties.put(<span class="org-string">"city"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"text"</span>));
        properties.put(<span class="org-string">"createTime"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"long"</span>));
        <span class="org-type">Map</span>&lt;<span class="org-type">String</span>, <span class="org-type">Object</span>&gt; <span class="org-variable-name">mapping</span> = <span class="org-keyword">new</span> <span class="org-type">HashMap</span>&lt;&gt;();
        mapping.put(<span class="org-string">"properties"</span>, properties);
        <span class="org-comment-delimiter">//</span><span class="org-comment">&#28155;&#21152;&#19968;&#20010;&#40664;&#35748;&#31867;&#22411;</span>
        System.out.println(JSON.toJSONString(request));
        request.mapping(<span class="org-string">"_doc"</span>,mapping);
        <span class="org-type">CreateIndexResponse</span> <span class="org-variable-name">response</span> = client.indices().create(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.isAcknowledged());
    }

}
</pre>
</div>
        </details></li>

<li><p>
delete
</p>

<details id='org29d090d' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org29d090d'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#21024;&#38500;&#32034;&#24341;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">deleteIndex</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">DeleteIndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">DeleteIndexRequest</span>(<span class="org-string">"cs_index1"</span>);
        <span class="org-type">AcknowledgedResponse</span> <span class="org-variable-name">response</span> = client.indices().delete(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.isAcknowledged());
    }


}
</pre>
</div>
        </details></li>

<li><p>
query
</p>

<details id='org1c80ce0' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org1c80ce0'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26597;&#35810;&#32034;&#24341;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">getIndex</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#35831;&#27714;</span>
        <span class="org-type">GetIndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetIndexRequest</span>();
        request.indices(<span class="org-string">"cs_index"</span>);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#25191;&#34892;&#35831;&#27714;,&#33719;&#21462;&#21709;&#24212;</span>
        <span class="org-type">GetIndexResponse</span> <span class="org-variable-name">response</span> = client.indices().get(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }

}
</pre>
</div>
        </details></li>

<li><p>
query if exists
</p>

<details id='org1f400b0' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org1f400b0'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26816;&#26597;&#32034;&#24341;&#26159;&#21542;&#23384;&#22312;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">exists</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#35831;&#27714;</span>
        <span class="org-type">GetIndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetIndexRequest</span>();
        request.indices(<span class="org-string">"cs_index"</span>);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#25191;&#34892;&#35831;&#27714;,&#33719;&#21462;&#21709;&#24212;</span>
        <span class="org-type">boolean</span> <span class="org-variable-name">response</span> = client.indices().exists(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response);
    }

}
</pre>
</div>
        </details></li>

<li><p>
query to get all name of indexes
</p>

<details id='org61a0ccc' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org61a0ccc'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26597;&#35810;&#25152;&#26377;&#30340;&#32034;&#24341;&#21517;&#31216;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">getAllIndices</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">GetAliasesRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetAliasesRequest</span>();
        <span class="org-type">GetAliasesResponse</span> <span class="org-variable-name">response</span> =  client.indices().getAlias(request,<span class="org-constant">RequestOptions</span>.DEFAULT);
        <span class="org-type">Map</span>&lt;<span class="org-type">String</span>, <span class="org-type">Set</span>&lt;<span class="org-type">AliasMetaData</span>&gt;&gt; <span class="org-variable-name">map</span> = response.getAliases();
        <span class="org-type">Set</span>&lt;<span class="org-type">String</span>&gt; <span class="org-variable-name">indices</span> = map.keySet();
        <span class="org-keyword">for</span> (<span class="org-type">String</span> <span class="org-variable-name">key</span> : indices) {
            System.out.println(key);
        }
    }

}
</pre>
</div>
        </details></li>

<li><p>
query to get schema
</p>

<details id='orgddb6f32' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgddb6f32'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26597;&#35810;&#32034;&#24341;&#26144;&#23556;&#23383;&#27573;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">getMapping</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">GetMappingsRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetMappingsRequest</span>();
        request.indices(<span class="org-string">"cs_index"</span>);
        request.types(<span class="org-string">"_doc"</span>);
        <span class="org-type">GetMappingsResponse</span> <span class="org-variable-name">response</span> = client.indices().getMapping(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }


}
</pre>
</div>
        </details></li>

<li><p>
add mapping column
</p>

<details id='orgb99c94f' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgb99c94f'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">IndexJunit</span> {


    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;

    <span class="org-doc">/**</span>
<span class="org-doc">     * &#28155;&#21152;&#32034;&#24341;&#26144;&#23556;&#23383;&#27573;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">addMapping</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-type">PutMappingRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">PutMappingRequest</span>();
        request.indices(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);

        <span class="org-comment-delimiter">//</span><span class="org-comment">&#28155;&#21152;&#23383;&#27573;</span>
        <span class="org-type">Map</span>&lt;<span class="org-type">String</span>, <span class="org-type">Object</span>&gt; <span class="org-variable-name">properties</span> = <span class="org-keyword">new</span> <span class="org-type">HashMap</span>();
        properties.put(<span class="org-string">"accountName"</span>, ImmutableBiMap.of(<span class="org-string">"type"</span>, <span class="org-string">"keyword"</span>));
        <span class="org-type">Map</span>&lt;<span class="org-type">String</span>, <span class="org-type">Object</span>&gt; <span class="org-variable-name">mapping</span> = <span class="org-keyword">new</span> <span class="org-type">HashMap</span>&lt;&gt;();
        mapping.put(<span class="org-string">"properties"</span>, properties);
        request.source(mapping);
        <span class="org-type">PutMappingResponse</span> <span class="org-variable-name">response</span> = client.indices().putMapping(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.isAcknowledged());
    }


}
</pre>
</div>
        </details></li>
</ol>
</div>
</div>

<div id="outline-container-orgd657810" class="outline-2">
<h2 id="orgd657810"><span class="section-number-2">5.</span> Doc Management</h2>
<div class="outline-text-2" id="text-5">
<ol class="org-ol">
<li><p>
Bean
</p>

<details id='org8761fa8' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org8761fa8'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">UserDocument</span> {

    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">id</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">name</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">sex</span>;
    <span class="org-keyword">private</span> <span class="org-type">Integer</span> <span class="org-variable-name">age</span>;
    <span class="org-keyword">private</span> <span class="org-type">String</span> <span class="org-variable-name">city</span>;
    <span class="org-keyword">private</span> <span class="org-type">Date</span> <span class="org-variable-name">createTime</span>;

    <span class="org-comment-delimiter">//</span><span class="org-comment">&#30465;&#30053;get&#12289;set...</span>
}
</pre>
</div>
        </details></li>

<li><p>
add
</p>

<details id='orgf734f94' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgf734f94'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#28155;&#21152;&#25991;&#26723;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">addDocument</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#23545;&#35937;</span>
        <span class="org-type">UserDocument</span> <span class="org-variable-name">user</span> = <span class="org-keyword">new</span> <span class="org-type">UserDocument</span>();
        user.setId(<span class="org-string">"1"</span>);
        user.setName(<span class="org-string">"&#37324;&#26031;"</span>);
        user.setCity(<span class="org-string">"&#27494;&#27721;"</span>);
        user.setSex(<span class="org-string">"&#30007;"</span>);
        user.setAge(<span class="org-highlight-numbers-number">20</span>);
        user.setCreateTime(<span class="org-keyword">new</span> <span class="org-type">Date</span>());

        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#32034;&#24341;,&#21363;&#33719;&#21462;&#32034;&#24341;</span>
        <span class="org-type">IndexRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">IndexRequest</span>();
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
        request.id(<span class="org-string">"1"</span>);
        request.index(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);
        request.timeout(TimeValue.timeValueSeconds(<span class="org-highlight-numbers-number">1</span>));
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#23384;&#20837;&#23545;&#35937;</span>
        request.source(JSON.toJSONString(user), <span class="org-constant">XContentType</span>.JSON);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21457;&#36865;&#35831;&#27714;</span>
        System.out.println(request.toString());
        <span class="org-type">IndexResponse</span> <span class="org-variable-name">response</span> = client.index(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }

}
</pre>
</div>
        </details></li>

<li><p>
upate
</p>

<details id='org9fd4abb' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org9fd4abb'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26356;&#26032;&#25991;&#26723;&#65288;&#25353;&#38656;&#20462;&#25913;&#65289;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">updateDocument</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#23545;&#35937;</span>
        <span class="org-type">UserDocument</span> <span class="org-variable-name">user</span> = <span class="org-keyword">new</span> <span class="org-type">UserDocument</span>();
        user.setId(<span class="org-string">"2"</span>);
        user.setName(<span class="org-string">"&#31243;&#21676;&#37329;"</span>);
        user.setCreateTime(<span class="org-keyword">new</span> <span class="org-type">Date</span>());
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#32034;&#24341;,&#21363;&#33719;&#21462;&#32034;&#24341;</span>
        <span class="org-type">UpdateRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">UpdateRequest</span>();
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
        request.id(<span class="org-string">"2"</span>);
        request.index(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);
        request.timeout(TimeValue.timeValueSeconds(<span class="org-highlight-numbers-number">1</span>));
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#23384;&#20837;&#23545;&#35937;</span>
        request.doc(JSON.toJSONString(user), <span class="org-constant">XContentType</span>.JSON);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21457;&#36865;&#35831;&#27714;</span>
        System.out.println(request.toString());
        <span class="org-type">UpdateResponse</span> <span class="org-variable-name">response</span> = client.update(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }


}
</pre>
</div>
        </details></li>

<li><p>
delete
</p>

<details id='org327a275' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org327a275'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#21024;&#38500;&#25991;&#26723;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">deleteDocument</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#32034;&#24341;,&#21363;&#33719;&#21462;&#32034;&#24341;</span>
        <span class="org-type">DeleteRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">DeleteRequest</span>();
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
        request.id(<span class="org-string">"1"</span>);
        request.index(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);
        request.timeout(TimeValue.timeValueSeconds(<span class="org-highlight-numbers-number">1</span>));
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21457;&#36865;&#35831;&#27714;</span>
        System.out.println(request.toString());
        <span class="org-type">DeleteResponse</span> <span class="org-variable-name">response</span> = client.delete(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }


}
</pre>
</div>
        </details></li>

<li><p>
query if not exists
</p>

<details id='orgf060d80' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgf060d80'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#26597;&#35810;&#25991;&#26723;&#26159;&#19981;&#26159;&#23384;&#22312;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">exists</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#32034;&#24341;,&#21363;&#33719;&#21462;&#32034;&#24341;</span>
        <span class="org-type">GetRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetRequest</span>();
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
        request.id(<span class="org-string">"3"</span>);
        request.index(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21457;&#36865;&#35831;&#27714;</span>
        System.out.println(request.toString());
        <span class="org-type">boolean</span> <span class="org-variable-name">response</span> = client.exists(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response);
    }
}
</pre>
</div>
        </details></li>

<li><p>
query by id
</p>

<details id='org4bd1555' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org4bd1555'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#36890;&#36807;ID&#65292;&#26597;&#35810;&#25351;&#23450;&#25991;&#26723;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">getById</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#32034;&#24341;,&#21363;&#33719;&#21462;&#32034;&#24341;</span>
        <span class="org-type">GetRequest</span> <span class="org-variable-name">request</span> = <span class="org-keyword">new</span> <span class="org-type">GetRequest</span>();
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
        request.id(<span class="org-string">"1"</span>);
        request.index(<span class="org-string">"cs_index"</span>);
        request.type(<span class="org-string">"_doc"</span>);
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21457;&#36865;&#35831;&#27714;</span>
        System.out.println(request.toString());
        <span class="org-type">GetResponse</span> <span class="org-variable-name">response</span> = client.get(request, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.toString());
    }
}
</pre>
</div>
        </details></li>

<li><p>
batch
</p>

<details id='org16bf6b9' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org16bf6b9'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RunWith</span>(SpringJUnit4ClassRunner.<span class="org-keyword">class</span>)
<span class="org-c-annotation">@SpringBootTest</span>(classes = ElasticSearchApplication.<span class="org-keyword">class</span>)
<span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DocJunit</span> {

    <span class="org-c-annotation">@Autowired</span>
    <span class="org-keyword">private</span> <span class="org-type">RestHighLevelClient</span> <span class="org-variable-name">client</span>;


    <span class="org-doc">/**</span>
<span class="org-doc">     * &#25209;&#37327;&#28155;&#21152;&#25991;&#26723;</span>
<span class="org-doc">     * </span><span class="org-doc"><span class="org-doc-markup">@throws</span></span><span class="org-doc"> IOException</span>
<span class="org-doc">     */</span>
    <span class="org-c-annotation">@Test</span>
    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">batchAddDocument</span>() <span class="org-keyword">throws</span> <span class="org-type">IOException</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#25209;&#37327;&#35831;&#27714;</span>
        <span class="org-type">BulkRequest</span> <span class="org-variable-name">bulkRequest</span> = <span class="org-keyword">new</span> <span class="org-type">BulkRequest</span>();
        bulkRequest.timeout(TimeValue.timeValueSeconds(<span class="org-highlight-numbers-number">10</span>));
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#21019;&#24314;&#23545;&#35937;</span>
        <span class="org-type">List</span>&lt;<span class="org-type">UserDocument</span>&gt; <span class="org-variable-name">userArrayList</span> = <span class="org-keyword">new</span> <span class="org-type">ArrayList</span>&lt;&gt;();
        userArrayList.add(<span class="org-keyword">new</span> <span class="org-type">UserDocument</span>(<span class="org-string">"&#24352;&#19977;"</span>, <span class="org-string">"&#30007;"</span>, <span class="org-highlight-numbers-number">30</span>, <span class="org-string">"&#27494;&#27721;"</span>));
        userArrayList.add(<span class="org-keyword">new</span> <span class="org-type">UserDocument</span>(<span class="org-string">"&#37324;&#26031;"</span>, <span class="org-string">"&#22899;"</span>, <span class="org-highlight-numbers-number">31</span>, <span class="org-string">"&#21271;&#20140;"</span>));
        userArrayList.add(<span class="org-keyword">new</span> <span class="org-type">UserDocument</span>(<span class="org-string">"&#29579;&#20116;"</span>, <span class="org-string">"&#30007;"</span>, <span class="org-highlight-numbers-number">32</span>, <span class="org-string">"&#27494;&#27721;"</span>));
        userArrayList.add(<span class="org-keyword">new</span> <span class="org-type">UserDocument</span>(<span class="org-string">"&#36213;&#20845;"</span>, <span class="org-string">"&#22899;"</span>, <span class="org-highlight-numbers-number">33</span>, <span class="org-string">"&#38271;&#27801;"</span>));
        userArrayList.add(<span class="org-keyword">new</span> <span class="org-type">UserDocument</span>(<span class="org-string">"&#19971;&#19971;"</span>, <span class="org-string">"&#30007;"</span>, <span class="org-highlight-numbers-number">34</span>, <span class="org-string">"&#27494;&#27721;"</span>));
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#28155;&#21152;&#35831;&#27714;</span>
        <span class="org-keyword">for</span> (<span class="org-type">int</span> <span class="org-variable-name">i</span> = <span class="org-highlight-numbers-number">0</span>; i &lt; userArrayList.<span class="org-type">size</span>(); i++) {
            userArrayList.get(i).setId(String.valueOf(i));
            <span class="org-type">IndexRequest</span> <span class="org-variable-name">indexRequest</span> = <span class="org-keyword">new</span> <span class="org-type">IndexRequest</span>();
            <span class="org-comment-delimiter">// </span><span class="org-comment">&#22806;&#23618;&#21442;&#25968;</span>
            indexRequest.id(String.valueOf(i));
            indexRequest.index(<span class="org-string">"cs_index"</span>);
            indexRequest.type(<span class="org-string">"_doc"</span>);
            indexRequest.timeout(TimeValue.timeValueSeconds(<span class="org-highlight-numbers-number">1</span>));
            indexRequest.source(JSON.toJSONString(userArrayList.get(i)), <span class="org-constant">XContentType</span>.JSON);
            bulkRequest.add(indexRequest);
        }
        <span class="org-comment-delimiter">// </span><span class="org-comment">&#25191;&#34892;&#35831;&#27714;</span>
        <span class="org-type">BulkResponse</span> <span class="org-variable-name">response</span> = client.bulk(bulkRequest, <span class="org-constant">RequestOptions</span>.DEFAULT);
        System.out.println(response.status());
    }

}
</pre>
</div>
        </details></li>
</ol>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Luke Yao</p>
<p class="date">Created: 2022-10-09 Sun 18:20</p>
</div>
</div>
</body>
</html>
