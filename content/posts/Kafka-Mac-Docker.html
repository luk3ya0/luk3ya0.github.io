<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-10-09 Sun 18:20 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Luke Yao" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<!-- HTML -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css">
<script src="/ox-html.js"></script>
<link rel="stylesheet" href="/ox-html.css">
</head>
<body>
<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label><div id="content">
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#kafka-搭建">1. Kafka on Docker</a>
<ul>
<li><a href="#建立zookeeper容器">1.1. 建立Zookeeper容器:</a></li>
<li><a href="#建立kafka集群节点">1.2. 建立kafka集群节点:</a></li>
<li><a href="#kafka-manager">1.3. Kafka Manager</a></li>
</ul>
</li>
</ul>
</div>
</nav>
<div id="outline-container-kafka-搭建" class="outline-2">
<h2 id="kafka-搭建"><span class="section-number-2">1.</span> Kafka on Docker</h2>
<div class="outline-text-2" id="text-kafka-搭建">
</div>

<div id="outline-container-建立zookeeper容器" class="outline-3">
<h3 id="建立zookeeper容器"><span class="section-number-3">1.1.</span> 建立Zookeeper容器:</h3>
<div class="outline-text-3" id="text-建立zookeeper容器">
<p>
这里用最简单的方式创建一个独立的Zookeeper节点, 如果要考虑zookeeper的高可用, 可以将其做成一个集群, 最好是能有多台机器.
</p>

<details id='org36476b7' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#org36476b7'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell">$ docker run -d --name zookeeper -p 2181:2181 -t wurstmeister/zookeeper
</pre>
</div>
        </details>

<p>
默认的, 容器内配置文件在, /conf/zoo.cfg, 数据和日志目录默认在/data 和 /datalog, 需要的话可以将上述目录映射到宿主机的可靠文件目录下. 
</p>
</div>
</div>

<div id="outline-container-建立kafka集群节点" class="outline-3">
<h3 id="建立kafka集群节点"><span class="section-number-3">1.2.</span> 建立kafka集群节点:</h3>
<div class="outline-text-3" id="text-建立kafka集群节点">
<p>
使用docker命令可快速在同一台机器搭建多个kafka, 只需要改变brokerId和端口
</p>

<ul class="org-ul">
<li>节点1:</li>
</ul>

<details id='orgb6d319a' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#orgb6d319a'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell">$ docker run  -d --name kafka0 -p 9092:9092 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_BROKER_ID</span>=<span class="org-highlight-numbers-number">0</span> <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ZOOKEEPER_CONNECT</span>=192.168.0.103:2181 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ADVERTISED_LISTENERS</span>=PLAINTEXT://192.168.0.103:9092 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_LISTENERS</span>=PLAINTEXT://0.0.0.0:9092 <span class="org-sh-escaped-newline">\</span>
    -t wurstmeister/kafka
</pre>
</div>
        </details>

<ul class="org-ul">
<li>节点2:</li>
</ul>

<details id='orgb95a60e' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#orgb95a60e'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell">$ docker run -d --name kafka1 -p 9093:9093 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_BROKER_ID</span>=<span class="org-highlight-numbers-number">1</span> <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ZOOKEEPER_CONNECT</span>=192.168.0.103:2181 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ADVERTISED_LISTENERS</span>=PLAINTEXT://192.168.0.103:9093 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_LISTENERS</span>=PLAINTEXT://0.0.0.0:9093 <span class="org-sh-escaped-newline">\</span>
    -t wurstmeister/kafka
</pre>
</div>
        </details>

<ul class="org-ul">
<li>节点3:</li>
</ul>

<details id='org159e67c' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#org159e67c'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell">$ docker run -d --name kafka3 -p 9095:9095 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_BROKER_ID</span>=<span class="org-highlight-numbers-number">2</span> <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ZOOKEEPER_CONNECT</span>=192.168.0.103:2181 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_ADVERTISED_LISTENERS</span>=PLAINTEXT://192.168.0.103:9095 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">KAFKA_LISTENERS</span>=PLAINTEXT://0.0.0.0:9095 <span class="org-sh-escaped-newline">\</span>
    -t wurstmeister/kafka
</pre>
</div>
        </details>

<p>
这里面主要设置了 <b>4</b> 个参数
</p>

<details id='orgf87f235' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#orgf87f235'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">KAFKA_BROKER_ID</span>=<span class="org-highlight-numbers-number">0</span>

<span class="org-variable-name">KAFKA_ZOOKEEPER_CONNECT</span>=192.168.0.103:2181

<span class="org-variable-name">KAFKA_ADVERTISED_LISTENERS</span>=PLAINTEXT://192.168.0.103:9092

<span class="org-variable-name">KAFKA_LISTENERS</span>=PLAINTEXT://0.0.0.0:9092
</pre>
</div>
        </details>

<p>
中间两个参数的 <code>192.168.0.102</code> 改为 <code>宿主机器</code> 的IP地址, 如果不这么设置, 可能会导致在别的机器上访问不到 kafka. 
</p>
</div>
</div>

<div id="outline-container-kafka-manager" class="outline-3">
<h3 id="kafka-manager"><span class="section-number-3">1.3.</span> Kafka Manager</h3>
<div class="outline-text-3" id="text-kafka-manager">
<details id='org5910152' class='code' open><summary><span class="lang">Shell Script</span></summary>
        <div class='gutter'>
        <a href='#org5910152'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>⎘</button>        </div>
        <div class="org-src-container">
<pre class="src src-shell">$ docker run -itd --restart=always --name=kafka-manager -p 9000:9000 <span class="org-sh-escaped-newline">\</span>
    -e <span class="org-variable-name">ZK_HOSTS</span>=<span class="org-string">"192.168.0.103:2181"</span> <span class="org-sh-escaped-newline">\</span>
    -t sheepkiller/kafka-manager
</pre>
</div>
        </details>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Luke Yao</p>
<p class="date">Created: 2022-10-09 Sun 18:20</p>
</div>
</div>
</body>
</html>
