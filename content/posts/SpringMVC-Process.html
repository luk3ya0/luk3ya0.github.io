<!DOCTYPE html>
<html lang="en">
<head>
<!-- 2022-10-09 Sun 18:20 -->
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>&lrm;</title>
<meta name="author" content="Luke Yao" />
<meta name="generator" content="Org Mode" />
<link rel="icon" href="https://tecosaur.com/resources/org/nib.ico" type="image/ico" />

<!-- HTML -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/firacode@6.2.0/distr/fira_code.css">
<script>
// @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&dn=expat.txt Expat
window.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById("text-table-of-contents")) {
        const sections = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        const activate = (entry) => {
            entry.classList.add('active');
            if (["LI", "UL"].includes(entry.parentElement.tagName)) {
                activate(entry.parentElement);
            }
        };
        const activateLast = () => {
            document.querySelectorAll('#text-table-of-contents li.active, #text-table-of-contents ul.active').forEach(a => {
                a.classList.remove('active')
            });
            let mostRecent = { section: sections[0], bottom: -Infinity };
            const windowHeight = window.innerHeight;
            sections.forEach((section) => {
                const bounds = section.getBoundingClientRect()
                if ( bounds.bottom > mostRecent.bottom && bounds.top < windowHeight ) {
                    mostRecent = { section, bottom: bounds.bottom };
                }
            })
            activate(document.querySelector(`#text-table-of-contents li a[href="#${mostRecent.section.getAttribute('id')}"]`).parentElement);
        }
        const observer = new IntersectionObserver(entries => {
            activateLast();
        });
        sections.forEach((section) => {
            observer.observe(section);
        });}
});

function copyPreToClipbord(btn) {
    const pre = btn.parentElement.parentElement.getElementsByTagName("PRE")[0];
    const range = document.createRange();
    range.selectNodeContents(pre);
    range.setEnd(pre.childNodes[pre.childNodes.length-1], 0);
    window.getSelection().addRange(range);
    var successful = document.execCommand('copy');
    window.getSelection().removeRange(range);
}
window.addEventListener('DOMContentLoaded', () => {
    if (document.getElementById("text-table-of-contents")) {
        const sections = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        const activate = (entry) => {
            entry.classList.add('active');
            if (["LI", "UL"].includes(entry.parentElement.tagName)) {
                activate(entry.parentElement);
            }
        };
        const activateLast = () => {
            document.querySelectorAll('#text-table-of-contents li.active, #text-table-of-contents ul.active').forEach(a => {
                a.classList.remove('active')
            });
            let mostRecent = { section: sections[0], bottom: -Infinity };
            const windowHeight = window.innerHeight;
            sections.forEach((section) => {
                const bounds = section.getBoundingClientRect()
                if ( bounds.bottom > mostRecent.bottom && bounds.top < windowHeight ) {
                    mostRecent = { section, bottom: bounds.bottom };
                }
            })
            activate(document.querySelector(`#text-table-of-contents li a[href="#${mostRecent.section.getAttribute('id')}"]`).parentElement);
        }
        const observer = new IntersectionObserver(entries => {
            activateLast();
        });
        sections.forEach((section) => {
            observer.observe(section);
        });}
});
// @license-end
</script>
<style>
@charset "UTF-8";
/*! normalize.css v8.0.1 | MIT License | github.com/necolas/normalize.css */
html {
    line-height: 1.15;
    -webkit-text-size-adjust: 100%;
}

body {
    font-family: "Fira Code";
    margin: 0;
}

hr {
    box-sizing: content-box;
    height: 0;
}

pre {
    font-family: monospace, monospace;
    font-size: 1em;
}

b {
    font-weight: bolder;
}

code,
kbd,
samp {
    font-family: monospace, monospace;
    font-size: 1em;
}

small {
    font-size: 1em;
}

sub,
sup {
    font-size: 1em;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sub {
    bottom: -0.25em;
}

sup {
    top: -0.5em;
}

button,
input,
optgroup,
select,
textarea {
    font-family: inherit;
    font-size: 1em;
    line-height: 1.15;
    margin: 0;
}

button,
select {
    text-transform: none;
}

button {
    -webkit-appearance: button;
}

button::-moz-focus-inner {
    border-style: none;
    padding: 0;
}

button:-moz-focusring {
    outline: 1px dotted ButtonText;
}

details {
    display: block;
}

summary {
    display: list-item;
}

@media (prefers-color-scheme: dark) {
    #theme-switch:checked ~ #page {
        --accent: #002642;
        --accent-dark: #00151c;
        --code-foreground: #2c3e50;
        --code-background: #efefef;
        --code-func: #6c3163;
        --code-const: #4e3163;
        --code-regex: #655370;
        --back-white: #fff;
        --back-light: #f0eeed;
        --back-medium: #c8c8c8;
        --text-light: #7b7b7b;
        --text-gray: #444;
        --text-medium: #222;
        --text-dark: #000;
        --switch-icon: "ðŸŒš";
        --switch-shadow-color: #373d4e;
        --switch-text: "dark mode?";
    }

    #theme-switch:checked ~ #page img.invertible, #theme-switch:checked ~ #page object[type="image/svg+xml"].invertible {
        filter: none;
    }

    #page {
        --accent: #002642;
        --accent-dark: #daf1ff;
        --code-foreground: #a1a8ae;
        --code-background: #222;
        --code-func: #bd56ad;
        --code-const: #8755ab;
        --code-regex: #a184b3;
        --back-white: #000;
        --back-light: #181818;
        --back-medium: #444;
        --text-light: #7b7b7b;
        --text-gray: #c8c8c8;
        --text-medium: #ddd;
        --text-dark: #efefef;
        --switch-icon: "ðŸŒ";
        --switch-shadow-color: #fce477;
        --switch-text: "light mode?";
    }

    #page img.invertible, #page object[type="image/svg+xml"].invertible {
        filter: invert(90%) hue-rotate(180deg) sepia(1%);
    }
}

/*! end normalise.css */
@media (prefers-color-scheme: light) {
    #page {
        --accent: #002642;
        --accent-dark: #00151c;
        --code-foreground: #2c3e50;
        --code-background: #efefef;
        --code-func: #6c3163;
        --code-const: #4e3163;
        --code-regex: #655370;
        --back-white: #fff;
        --back-light: #f0eeed;
        --back-medium: #c8c8c8;
        --text-light: #7b7b7b;
        --text-gray: #444;
        --text-medium: #222;
        --text-dark: #000;
        --switch-icon: "ðŸŒš";
        --switch-shadow-color: #373d4e;
        --switch-text: "dark mode?";
    }

    #theme-switch:checked ~ #page {
        --accent: #002642;
        --accent-dark: #daf1ff;
        --code-foreground: #a1a8ae;
        --code-background: #222;
        --code-func: #bd56ad;
        --code-const: #8755ab;
        --code-regex: #a184b3;
        --back-white: #000;
        --back-light: #181818;
        --back-medium: #444;
        --text-light: #7b7b7b;
        --text-gray: #c8c8c8;
        --text-medium: #ddd;
        --text-dark: #efefef;
        --switch-icon: "ðŸŒ";
        --switch-shadow-color: #fce477;
        --switch-text: "light mode?";
    }

    #theme-switch:checked ~ #page img.invertible, #theme-switch:checked ~ #page object[type="image/svg+xml"].invertible {
        filter: invert(90%) hue-rotate(180deg) sepia(1%);
    }
}

#theme-switch {
    display: none;
}

#switch-label {
    position: fixed;
    bottom: 4rem;
    left: 3rem;
}

#switch-label::before {
    content: var(--switch-icon);
    font-size: 1em;
    transition: text-shadow .2s;
}

#switch-label::after {
    content: var(--switch-text);
    color: var(--switch-shadow-color);
    font-size: 1em;
    visibility: hidden;
    margin-left: 0.5em;
    z-index: 1;
    position: fixed;
    bottom: calc(4rem - 25px);
    left: calc(3rem - 10px);
}

@media (max-width: 1000px) {
    #switch-label {
        left: auto;
        bottom: auto;
        right: 1vw;
        top: 1vh;
    }

    #switch-label::after {
        position: fixed;
        top: calc(1vh + 3px);
        right: calc(1vw + 30px);
        left: auto;
        bottom: auto;
    }
}

#theme-switch:focus ~ #page #switch-label::before,
#switch-label:hover::before {
    text-shadow: 0 0 15px var(--switch-shadow-color);
}

#theme-switch:focus ~ #page #switch-label::after,
#switch-label:hover::after {
    visibility: visible;
}

*::selection {
    background: var(--back-medium);
}

.pace .pace-progress {
    background-color: var(--accent) !important;
}

html, body {
    height: 100%;
}

body {
    background-color: var(--back-light);
    display: flex;
    flex-direction: column;
    font-size: 1em;
}

#page {
    color: var(--text-dark);
    background-color: var(--back-light);
    transition-property: color, background-color;
    transition-duration: 100ms;
}

#content, header, .page-header {
    margin: 32px;
    flex: 1 0 auto;
}

#content {
    margin: 0 auto;
    margin-top: 4rem;
    min-height: calc(100vh - 4rem - 48px);
}

#content p {
    line-height: 2 !important;
}

div#content {
    max-width: 1080px;
    margin: 0 auto;
}

.clearfix::after {
    clear: both;
}

.clearfix::before, .clearfix::after {
    content: " ";
    display: table;
}

.page-header {
    margin-top: 80px;
    margin-left: 0 !important;
}

.page-header h1 {
    font-size: 1em;
    text-transform: none;
}

.page-header .subtitle {
    font-size: 1em;
    color: var(--text-light);
    margin: 0;
}

.page-meta {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
}

header .site-nav {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
    font-weight: bold;
    line-height: 2.0;
    margin-top: 22px;
}

header .site-nav a {
    color: var(--text-light);
    text-decoration: none;
    margin-left: 10px;
}

header .site-nav a:hover {
    color: var(--text-gray);
}

header .site-nav a.active {
    border-bottom: solid;
    border-bottom-width: 2px;
}

header .site-nav a:first-child {
    margin-left: 0;
}

header > div {
    display: inherit;
}

.site-title {
    font-size: 1em;
}

.site-title span {
    display: none !important;
}

.site-title ul {
    display: block !important;
    list-style: none;
    padding: 0;
    margin: 0;
}

.site-title ul img {
    border-radius: 2px;
    max-width: 32px;
}

.site-header nav a {
    color: var(--text-light);
    font-family: "Fira Code", sans;
    font-size: 1em;
    font-weight: bold;
    text-transform: uppercase;
}

.site-header nav a:hover {
    border: 0;
    color: var(--accent);
}

@media (max-width: 1000px) {
    header * {
        display: inline;
    }
}

@media (min-width: 1000px) {
    #content, header, .page-header {
        max-width: 720px;
        margin-left: 164px;
    }

    header .site-title {
        float: left;
    }

    header .site-nav {
        float: right;
        margin-top: 0;
    }
}

@media (min-width: 2800px) {
    #content, header, .page-header {
        margin-left: auto;
        margin-right: auto;
    }
}

#content .page-intro {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
    margin-bottom: 40px;
}

#content p, #content li, #content dd {
    line-height: 2;
    margin-top: 0;
}

#footer {
    margin-top: 70px;
    height: 10px;
    background: var(--accent-dark);
}

.archive-item {
    margin: 50px 0;
}

.archive-item .archive-title {
    font-size: 1em;
    margin: 5px 0;
    background: none;
    text-shadow: none;
    text-decoration: none;
}

.archive-item .archive-title:hover {
    background: none;
    text-shadow: none;
    text-decoration: none;
}

#postamble {
    display: none;
}

aside {
    background-color: var(--code-background);
    border-radius: 5px;
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
    margin: 20px 0;
    padding: 5px 20px 10px;
    line-height: 1.6 !important;
}

aside p {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
    line-height: 1.6 !important;
}

aside pre {
    font-size: 1em;
    border: none;
    padding-left: 0;
}

@media (min-width: 1280px) {
    aside {
        float: right;
        clear: right;
        background-color: var(--back-white);
        max-width: 45% !important;
        margin-right: -52%;
    }

    aside::before {
        content: '';
    }
}

blockquote {
    border-width: 0;
    border-left-style: solid;
    border-left-width: 1px;
    border-left-color: var(--back-medium);
    margin: 20px 0;
    padding: 0;
    padding-left: 15px;
}

blockquote p {
    display: inline;
    font-size: 1em;
}

blockquote footer {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
    text-transform: none;
}

div.info {
    background: rgba(58, 129, 195, 0.15);
    border-left: 4px solid rgba(58, 129, 195, 0.45);
    margin: 1.8rem 0 1.25rem 15px;
    padding: 0.8em;
    line-height: 1.4;
    text-align: center;
    position: relative;
    clear: both;
}

div.info p {
    margin: 0;
}

div.info::before {
    content: "i";
    color: var(--back-white);
    background: rgba(58, 129, 195, 0.8);
    align-items: flex-end;
    top: -1rem;
    font-weight: 700;
    font-size: 1em;
    -webkit-clip-path: circle(50% at 50% 50%);
    clip-path: circle(50% at 50% 50%);
    width: 30px;
    height: 30px;
    display: inline-flex;
    justify-content: center;
    position: absolute;
    left: -1.2rem;
    line-height: 1.3;
    text-align: center;
}

div.success {
    background: rgba(45, 149, 116, 0.15);
    border-left: 4px solid rgba(45, 149, 116, 0.45);
    margin: 1.8rem 0 1.25rem 15px;
    padding: 0.8em;
    line-height: 1.4;
    text-align: center;
    position: relative;
    clear: both;
}

div.success p {
    margin: 0;
}

div.success::before {
    content: "âœ”";
    color: var(--back-white);
    background: rgba(45, 149, 116, 0.8);
    align-items: flex-end;
    top: -1rem;
    font-weight: 700;
    font-size: 1em;
    -webkit-clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    clip-path: polygon(50% 0%, 100% 50%, 50% 100%, 0% 50%);
    width: 35px;
    height: 35px;
    display: inline-flex;
    justify-content: center;
    position: absolute;
    left: -1.2rem;
    line-height: 1.5;
    text-align: center;
}

div.warning {
    background: rgba(220, 117, 47, 0.15);
    border-left: 4px solid rgba(220, 117, 47, 0.45);
    margin: 1.8rem 0 1.25rem 15px;
    padding: 0.8em;
    line-height: 1.4;
    text-align: center;
    position: relative;
    clear: both;
}

div.warning p {
    margin: 0;
}

div.warning::before {
    content: "!";
    color: var(--back-white);
    background: rgba(220, 117, 47, 0.8);
    align-items: flex-end;
    top: -1rem;
    font-weight: 700;
    font-size: 1em;
    -webkit-clip-path: polygon(50% 0, 0 100%, 100% 100%);
    clip-path: polygon(50% 0, 0 100%, 100% 100%);
    width: 35px;
    height: 35px;
    display: inline-flex;
    justify-content: center;
    position: absolute;
    left: -1.2rem;
    line-height: 1.1;
    text-align: center;
}

div.error {
    background: rgba(186, 47, 89, 0.15);
    border-left: 4px solid rgba(186, 47, 89, 0.45);
    margin: 1.8rem 0 1.25rem 15px;
    padding: 0.8em;
    line-height: 1.4;
    text-align: center;
    position: relative;
    clear: both;
}

div.error p {
    margin: 0;
}

div.error::before {
    content: "!";
    color: var(--back-white);
    background: rgba(186, 47, 89, 0.8);
    align-items: flex-end;
    top: -1rem;
    font-weight: 700;
    font-size: 1em;
    -webkit-clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
    width: 35px;
    height: 30px;
    display: inline-flex;
    justify-content: center;
    position: absolute;
    left: -1.2rem;
    line-height: 1.1;
    text-align: center;
}

.org-ref-bib-h1 {
    border-width: 0;
    border-top-style: solid;
    border-top-width: 1px;
    border-color: var(--back-light);
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

.org-ref-bib {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

.org-ref-bib li > a:nth-child(2) {
    background: none;
    text-shadow: none;
    text-decoration: none;
}

.org-ref-bib li > a:nth-child(2):hover {
    background: none;
    text-shadow: none;
    text-decoration: none;
}

.org-ref-bib .bib-link {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
    background: none;
    text-shadow: none;
    text-decoration: none;
}

lable {
    display: block;
    margin: 1em auto;
}

pre.src, pre.example {
    border-width: 0;
    border-left-style: solid;
    border-left-width: 1px;
    border-left-color: var(--back-medium);
    margin: 20px 0;
    padding: 0;
    padding-left: 15px;
    font-family: "Fira Code", SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
    font-size: 0.8em;
    line-height: 1.5;
    overflow-x: visible;
    box-shadow: none;
    position: relative;
}

pre.example {
    border-left-style: dotted;
    border-left-width: 2px;
}

pre.src::before {
    display: inline-block;
    margin-top: 1em;
    position: absolute;
    background-color: transparent;
    top: unset;
    bottom: -16px;
    left: 20px;
    padding: 0px;
    border: none;
    font-size: 0.8em;
    font-style: italic;
    color: var(--text-light);
}

pre.src:empty {
    display: none;
}

code {
    font-family: "Fira Code", SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
    color: var(--code-foreground);
    font-size: 1em;
    padding: 0 5px;
}

kbd {
    display: inline-block;
    padding: 0.25em 0.35em;
    font: 80% SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
    font-weight: inherit;
    line-height: normal;
    line-height: 80%;
    color: var(--text-gray);
    vertical-align: middle;
    background-color: var(--back-light);
    border: 1px solid #91959a88;
    border-radius: 0.35em;
    box-shadow: inset 0 -1px 0 #91959a88;
}

li code {
    font-size: 1em;
}

li p code {
    font-size: 1em;
}

details.code {
    margin-top: 2em;
    margin-bottom: 2em;
    position: relative;
}

details.code summary {
    position: relative;
    left: -2.5px;
    padding-left: 10px;
    padding-bottom: 4px;
    margin-left: -10px;
    z-index: 1;
    outline: none;
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 0.8em;
    line-height: 1.5;
    color: var(--text-light);
}

details.code[open] {
    margin-top: 1em;
    margin-bottom: 3em;
}

details.code summary .name {
    font-size: 1em;
    color: var(--text-medium);
    margin-right: 0.7em;
}

details.code summary .lang {
    font-family: "Fira Code", SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
    font-style: italic;
}

details.code summary::marker {
    color: var(--back-medium);
}

details.code[open] summary {
    margin-bottom: -32px;
}

details.code[open] summary .lang {
    display: none;
}

details.code[open] summary.named {
    margin-bottom: -26px;
}

details.code:not([open]) summary {
    margin-bottom: -5px;
}

.example,
.src {
    color: var(--code-foreground);
}

.example .org-keyword,
.src .org-keyword {
    color: #3a81c3;
}

.example .org-variable-name,
.src .org-variable-name {
    color: #715ab1;
}

.example .org-rainbow-delimiters-depth-1,
.example .org-rainbow-delimiters-depth-2,
.example .org-rainbow-delimiters-depth-3,
.example .org-rainbow-delimiters-depth-4,
.example .org-rainbow-delimiters-depth-5,
.example .org-rainbow-delimiters-depth-6,
.example .org-rainbow-delimiters-depth-7,
.example .org-rainbow-delimiters-depth-8,
.example .org-rainbow-delimiters-depth-9,
.src .org-rainbow-delimiters-depth-1,
.src .org-rainbow-delimiters-depth-2,
.src .org-rainbow-delimiters-depth-3,
.src .org-rainbow-delimiters-depth-4,
.src .org-rainbow-delimiters-depth-5,
.src .org-rainbow-delimiters-depth-6,
.src .org-rainbow-delimiters-depth-7,
.src .org-rainbow-delimiters-depth-8,
.src .org-rainbow-delimiters-depth-9 {
    color: #555555;
}

.example .org-string,
.src .org-string {
    color: #2d9574;
}

.example .org-comment,
.example .org-comment-delimiter,
.src .org-comment,
.src .org-comment-delimiter {
    color: #555555;
}

.example .org-function-name,
.src .org-function-name {
    color: var(--code-func);
}

.example .org-constant,
.example .org-highlight-numbers-number,
.src .org-constant,
.src .org-highlight-numbers-number {
    color: var(--code-const);
}

.gutter {
    position: absolute;
    top: 0;
    left: -2.5rem;
    width: 2rem;
    padding-right: 0.3rem;
    padding-top: 5px;
    height: calc(100% - 10px);
    z-index: 1;
    transition: opacity 200ms;
    opacity: 0;
    font-size: 1em;
}

.gutter:hover {
    opacity: 1;
}

.gutter * {
    display: block;
    width: 100%;
    text-align: right;
    padding: 0;
    margin: 0;
    color: var(--text-light);
}

.gutter *:hover {
    color: var(--text-gray);
}

.gutter *:active {
    font-weight: bold;
}

.gutter a {
    text-decoration: none;
    font-size: 1em;
}

.gutter button {
    background: none;
    border: none;
}

/* Languages per Org manual */
pre.src-asymptote::before {
    content: 'Asymptote';
}

pre.src-authinfo::before {
    content: 'Authinfo';
}

pre.src-awk::before {
    content: 'Awk';
}

pre.src-C::before {
    content: 'C';
}

/* pre.src-C++ doesn't work in CSS */
pre.src-clojure::before {
    content: 'Clojure';
}

pre.src-css::before {
    content: 'CSS';
}

pre.src-D::before {
    content: 'D';
}

pre.src-ditaa::before {
    content: 'ditaa';
}

pre.src-dot::before {
    content: 'Graphviz';
}

pre.src-calc::before {
    content: 'Emacs Calc';
}

pre.src-emacs-lisp::before {
    content: 'Emacs Lisp';
}

pre.src-fortran::before {
    content: 'Fortran';
}

pre.src-gnuplot::before {
    content: 'gnuplot';
}

pre.src-haskell::before {
    content: 'Haskell';
}

pre.src-hledger::before {
    content: 'hledger';
}

pre.src-java::before {
    content: 'Java';
}

pre.src-js::before {
    content: 'Javascript';
}

pre.src-latex::before {
    content: 'LaTeX';
}

pre.src-ledger::before {
    content: 'Ledger';
}

pre.src-lisp::before {
    content: 'Lisp';
}

pre.src-lilypond::before {
    content: 'Lilypond';
}

pre.src-lua::before {
    content: 'Lua';
}

pre.src-matlab::before {
    content: 'MATLAB';
}

pre.src-mscgen::before {
    content: 'Mscgen';
}

pre.src-ocaml::before {
    content: 'Objective Caml';
}

pre.src-octave::before {
    content: 'Octave';
}

pre.src-org::before {
    content: 'Org mode';
}

pre.src-oz::before {
    content: 'OZ';
}

pre.src-plantuml::before {
    content: 'Plantuml';
}

pre.src-processing::before {
    content: 'Processing.js';
}

pre.src-python::before {
    content: 'Python';
}

pre.src-R::before {
    content: 'R';
}

pre.src-ruby::before {
    content: 'Ruby';
}

pre.src-sass::before {
    content: 'Sass';
}

pre.src-scheme::before {
    content: 'Scheme';
}

pre.src-screen::before {
    content: 'Gnu Screen';
}

pre.src-sed::before {
    content: 'Sed';
}

pre.src-sh::before {
    content: 'shell';
}

pre.src-sql::before {
    content: 'SQL';
}

pre.src-sqlite::before {
    content: 'SQLite';
}

/* additional languages in org.el's org-babel-load-languages alist */
pre.src-forth::before {
    content: 'Forth';
}

pre.src-io::before {
    content: 'IO';
}

pre.src-J::before {
    content: 'J';
}

pre.src-makefile::before {
    content: 'Makefile';
}

pre.src-maxima::before {
    content: 'Maxima';
}

pre.src-perl::before {
    content: 'Perl';
}

pre.src-picolisp::before {
    content: 'Pico Lisp';
}

pre.src-scala::before {
    content: 'Scala';
}

pre.src-shell::before {
    content: 'Shell Script';
}

pre.src-systemd::before {
    content: 'Systemd';
}

pre.src-ebnf2ps::before {
    content: 'ebfn2ps';
}

/* additional language identifiers per \"defun org-babel-execute\"
      in ob-*.el */
pre.src-cpp::before {
    content: 'C++';
}

pre.src-abc::before {
    content: 'ABC';
}

pre.src-coq::before {
    content: 'Coq';
}

pre.src-groovy::before {
    content: 'Groovy';
}

/* additional language identifiers from org-babel-shell-names in
    ob-shell.el: ob-shell is the only babel language using a lambda to put
    the execution function name together. */
pre.src-bash::before {
    content: 'bash';
}

pre.src-csh::before {
    content: 'csh';
}

pre.src-ash::before {
    content: 'ash';
}

pre.src-dash::before {
    content: 'dash';
}

pre.src-ksh::before {
    content: 'ksh';
}

pre.src-mksh::before {
    content: 'mksh';
}

pre.src-posh::before {
    content: 'posh';
}

/* Additional Emacs modes also supported by the LaTeX listings package */
pre.src-ada::before {
    content: 'Ada';
}

pre.src-asm::before {
    content: 'Assembler';
}

pre.src-caml::before {
    content: 'Caml';
}

pre.src-delphi::before {
    content: 'Delphi';
}

pre.src-html::before {
    content: 'HTML';
}

pre.src-idl::before {
    content: 'IDL';
}

pre.src-mercury::before {
    content: 'Mercury';
}

pre.src-metapost::before {
    content: 'MetaPost';
}

pre.src-modula-2::before {
    content: 'Modula-2';
}

pre.src-pascal::before {
    content: 'Pascal';
}

pre.src-ps::before {
    content: 'PostScript';
}

pre.src-prolog::before {
    content: 'Prolog';
}

pre.src-simula::before {
    content: 'Simula';
}

pre.src-tcl::before {
    content: 'tcl';
}

pre.src-tex::before {
    content: 'LaTeX';
}

pre.src-plain-tex::before {
    content: 'TeX';
}

pre.src-verilog::before {
    content: 'Verilog';
}

pre.src-vhdl::before {
    content: 'VHDL';
}

pre.src-xml::before {
    content: 'XML';
}

pre.src-nxml::before {
    content: 'XML';
}

pre.src-conf::before {
    content: 'Configuration File';
}

.dropcap {
    float: left;
    font-size: 1em;
    font-style: normal;
    line-height: .1;
    margin-right: 0.2em;
    margin-top: 0.5em;
    padding: 0;
}

figure {
    text-align: center;
}

figure figcaption {
    margin-top: 10px;
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

figure figcaption .figure-number {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
}

img.zoomTarget:hover {
    cursor: default !important;
}

img, object[type="image/svg+xml"] {
    filter: invert(7%) sepia(4%);
    max-width: 100%;
}

.org-svg {
    width: 90%;
}

#footnotes {
    margin-top: 70px;
    padding-top: 30px;
    border-width: 0;
    border-top-style: solid;
    border-top-width: 1px;
    border-color: var(--back-light);
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

#footnotes p, #footnotes li {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

#footnotes h2.footnotes {
    margin-top: 0;
    margin-bottom: 30px;
    font-family: "Fira Code", sans;
    font-size: 1em;
    letter-spacing: 5px;
    display: none;
}

#footnotes .footnum {
    color: var(--text-dark);
}

h1,
h2,
h3,
h4,
h5,
h6 {
    margin: 0;
    font-size: 1em !important;
    font-family: "Fira Code", serif;
    font-weight: normal;
    line-height: 2;
}

h1 {
   margin-bottom: 2em !important;
}

h2 {
   margin-bottom: 2em !important;
}

h3 {
   margin-bottom: 2em !important;
}

ol {
   margin-top: 0 !important;
   margin-bottom: 2em !important
}

h1::before {
    content: "* "
}

h2::before {
    content: "** "
}

h3::before {
    content: "*** "
}

h4::before {
    content: "***** "
}

h5::before {
    content: "****** "
}

.section-number-1,
.section-number-2,
.section-number-3,
.section-number-4,
.section-number-5 {
    display: none;
}

hr {
    border: none;
    border-top-style: solid;
    border-top-width: 1px;
    color: var(--back-medium);
    margin-bottom: 30px;
    margin-top: 40px;
}

a {
    color: inherit;
}

figcaption a,
p a,
.page-tags a,
table a,
li a,
dl a {
    background-image: linear-gradient(var(--text-dark), var(--text-dark));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    border-radius: 1px;
    text-decoration: none;
}

figcaption a::selection,
p a::selection,
.page-tags a::selection,
table a::selection,
li a::selection,
dl a::selection {
    background: var(--back-medium);
}

figcaption a *,
figcaption a *:after, figcaption a:after,
figcaption a *:before, figcaption a:before,
p a *,
p a *:after,
p a:after,
p a *:before,
p a:before,
.page-tags a *,
.page-tags a *:after,
.page-tags a:after,
.page-tags a *:before,
.page-tags a:before,
table a *,
table a *:after,
table a:after,
table a *:before,
table a:before,
li a *,
li a *:after,
li a:after,
li a *:before,
li a:before,
dl a *,
dl a *:after,
dl a:after,
dl a *:before,
dl a:before {
    text-shadow: none;
}

figcaption a:visited,
p a:visited,
.page-tags a:visited,
table a:visited,
li a:visited,
dl a:visited {
    color: var(--text-dark);
}

figcaption a:hover,
p a:hover,
.page-tags a:hover,
table a:hover,
li a:hover,
dl a:hover {
    opacity: 0.9;
    filter: drop-shadow(1px 1px 1px var(--back-white));
    background-image: linear-gradient(var(--text-dark), var(--text-dark));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23000000' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E") !important;
    background-position: 0% 100%;
    background-size: 0.8em auto;
    text-decoration: none;
}

figcaption a:hover::selection,
p a:hover::selection,
.page-tags a:hover::selection,
table a:hover::selection,
li a:hover::selection,
dl a:hover::selection {
    background: var(--back-white);
}

figcaption a[href^="#"],
p a[href^="#"],
.page-tags a[href^="#"],
table a[href^="#"],
li a[href^="#"],
dl a[href^="#"] {
    background-image: linear-gradient(var(--text-gray), var(--text-gray));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
}

figcaption a[href^="#"]::selection,
p a[href^="#"]::selection,
.page-tags a[href^="#"]::selection,
table a[href^="#"]::selection,
li a[href^="#"]::selection,
dl a[href^="#"]::selection {
    background: var(--back-white);
}

figcaption a[href^="#"]:hover,
p a[href^="#"]:hover,
.page-tags a[href^="#"]:hover,
table a[href^="#"]:hover,
li a[href^="#"]:hover,
dl a[href^="#"]:hover {
    opacity: 0.9;
    filter: drop-shadow(1px 1px 1px var(--back-white));
    background-image: linear-gradient(var(--text-medium), var(--text-medium));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
}

figcaption a[href^="#"]:hover::selection,
p a[href^="#"]:hover::selection,
.page-tags a[href^="#"]:hover::selection,
table a[href^="#"]:hover::selection,
li a[href^="#"]:hover::selection,
dl a[href^="#"]:hover::selection {
    background: var(--back-white);
}

#theme-switch:checked ~ #page #breadcrumbs a:hover,
#theme-switch:checked ~ #page figcaption a:hover,
#theme-switch:checked ~ #page p a:hover,
#theme-switch:checked ~ #page .page-tags a:hover,
#theme-switch:checked ~ #page table a:hover,
#theme-switch:checked ~ #page #crosslinks a:not(.highlight):hover,
#theme-switch:checked ~ #page li a:hover,
#theme-switch:checked ~ #page dl a:hover {
    background-image: url("data:image/svg+xml;charset=utf8,%3Csvg id='squiggle-link' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' xmlns:ev='http://www.w3.org/2001/xml-events' viewBox='0 0 20 4'%3E%3Cstyle type='text/css'%3E.squiggle{animation:shift .3s linear infinite;}@keyframes shift {from {transform:translateX(0);}to {transform:translateX(-20px);}}%3C/style%3E%3Cpath fill='none' stroke='%23ffffff' stroke-width='2' class='squiggle' d='M0,3.5 c 5,0,5,-3,10,-3 s 5,3,10,3 c 5,0,5,-3,10,-3 s 5,3,10,3'/%3E%3C/svg%3E");
}

*:target::before {
    display: none;
    /* content: "ðŸ –"; */
    position: absolute;
    left: -7rem;
    top: calc(0.5em - 2rem);
    line-height: 1;
    color: #e65353aa;
    font-size: 1em;
    font-style: normal;
}

@media (max-width: 1000px) {
    *:target::before {
        content: "ðŸ ”";
        left: unset;
        right: 0;
    }
}

#content .page-intro p a,
#footnotes a {
    background-image: linear-gradient(var(--text-gray), var(--text-gray));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    border-radius: 1px;
    text-decoration: none;
}

#content .page-intro p a::selection,
#footnotes a::selection {
    background: var(--back-medium);
}

#content .page-intro p a *,
#content .page-intro p a *:after, #content .page-intro p a:after,
#content .page-intro p a *:before, #content .page-intro p a:before,
#footnotes a *,
#footnotes a *:after,
#footnotes a:after,
#footnotes a *:before,
#footnotes a:before {
    text-shadow: none;
}

#content .page-intro p a:visited,
#footnotes a:visited {
    color: var(--text-gray);
}

#content .page-intro p a:hover,
#footnotes a:hover {
    background-image: linear-gradient(var(--text-gray), var(--text-gray));
    background-size: 1px 1px;
    background-repeat: repeat-x;
    background-position: 0% 95%;
    border-radius: 1px;
    text-decoration: none;
}

#content .page-intro p a:hover::selection,
#footnotes a:hover::selection {
    background: var(--back-medium);
}

#content .page-intro p a:hover *,
#content .page-intro p a:hover *:after, #content .page-intro p a:hover:after,
#content .page-intro p a:hover *:before, #content .page-intro p a:hover:before,
#footnotes a:hover *,
#footnotes a:hover *:after,
#footnotes a:hover:after,
#footnotes a:hover *:before,
#footnotes a:hover:before {
    text-shadow: none;
}

#content .page-intro p a:hover:visited,
#footnotes a:hover:visited {
    color: var(--text-gray);
}

.btn {
    padding: 7px 14px;
    border-style: solid;
    border-width: 1px;
    border-color: var(--back-light);
    border-radius: 1px;
    font-family: "Fira Code", sans;
    font-variant: all-small-caps;
    font-size: 1em;
    font-style: normal;
    letter-spacing: 2px;
    background-image: none;
    cursor: pointer;
}

.btn:hover {
    background-color: var(--back-light);
    background-image: none;
}

.btn.disabled {
    color: var(--text-light);
}

.btn.disabled:hover {
    cursor: default;
}

.btn.small {
    padding: 3px 6px;
    border-style: solid;
    border-width: 1px;
    border-color: var(--back-light);
    border-radius: 1px;
    font-family: "Fira Code", sans;
    font-variant: all-small-caps;
    font-size: 1em;
    font-style: normal;
    letter-spacing: 2px;
    background-image: none;
    padding-right: 9px;
    padding-left: 9px;
}

.btn.small:hover {
    background-color: var(--back-light);
    background-image: none;
}

.btn.highlight {
    text-shadow: none;
    text-decoration: none;
    color: var(--text-dark);
    background-color: yellow;
}

.btn.primary {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--accent);
}

.btn.primary:hover {
    background-color: var(--back-light);
    background-image: none;
    color: var(--text-dark);
}

.image-link, .image-link:hover {
    background: none;
    text-shadow: none;
    text-decoration: none;
}

div.link-preview {
    border: 1px solid var(--back-medium);
    border-radius: 0.5em;
    overflow: hidden;
    position: relative;
    max-height: 5em;
    padding-left: 0.5em;
}

div.link-preview a {
    color: initial;
    text-decoration: none;
}

div.link-preview img {
    border-right: 1px solid var(--back-medium);
    float: left;
    height: 5em;
    margin-left: -0.5em;
    margin-right: 0.5em;
}

div.link-preview p {
    margin: 0;
    font-size: 1em;
}

div.link-preview p b {
    font-size: 1em;
}

div.link-preview small {
    float: right;
    font-family: sans;
    color: var(--text-light);
    margin: 0.45em 0.6em;
}

ul, ol, dl {
    list-style: none;
    list-style-position: outside;
    padding: 0;
}

ul li::before, ul dt::before, ol li::before, ol dt::before, dl li::before, dl dt::before {
    display: inline-block;
    width: 1em;
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

ul li, ol li, dl li {
    margin: 5px 0;
    margin-left: 1em !important;
    font-size: 1em;
}

ul li p, ol li p, dl li p {
    font-size: 1em;
}

ul li::before {
    content: "â€¢";
    margin-left: -1em;
}

ol {
    counter-reset: li;
}

ol li::before {
    content: counter(li);
    margin-left: -1.5em;
    margin-right: 0.5em;
    text-align: right;
    direction: rtl;
}

ol li {
    counter-increment: li;
}

ul ul, ol ol {
    padding-left: 20px;
}

ul ul ul, ol ol ol {
    padding-left: 30px;
}

li p:first-child {
    display: inline-block;
    margin-bottom: 0;
}

dl dt::before {
    content: "â€¢";
    margin-left: -1em;
}

dl dt {
    font-weight: normal;
    margin-bottom: 10px;
}

dl dd {
    font-style: italic;
    margin-bottom: 20px;
}

li .checkbox {
    display: inline-block;
    width: 0.9em;
    height: 0.9em;
    border-radius: 3px;
    margin: 3px;
    top: 4px;
    position: relative;
}

li.on > .checkbox {
    background: #2d9574;
    box-shadow: 0 0 2px #2d9574;
}

li.trans > .checkbox {
    background: #dc752f;
    box-shadow: 0 0 2px #dc752f;
}

li.off > .checkbox {
    background: #ba2f59;
    box-shadow: 0 0 2px #ba2f59;
    top: 6px;
}

li.on > .checkbox::after {
    content: '';
    height: 0.45em;
    width: 0.225em;
    -webkit-transform-origin: left top;
    transform-origin: left top;
    transform: scaleX(-1) rotate(135deg);
    border-right: 2.8px solid #fff;
    border-top: 2.8px solid #fff;
    opacity: 0.9;
    left: 0.10em;
    top: 0.45em;
    position: absolute;
}

li.trans > .checkbox::after {
    content: '';
    font-weight: bold;
    font-size: 1em;
    position: absolute;
    top: 0.2em;
    left: 0.11em;
    width: 0.35em;
    height: 0.12em;
    background: #fff;
    opacity: 0.9;
    border-radius: 0.1em;
}

li.off > .checkbox::after {
    content: 'âœ–';
    color: #fff;
    opacity: 0.9;
    position: relative;
    top: -0.50rem;
    left: 0.17em;
    font-size: 1em;
}

#org-div-home-and-up {
    display: none !important;
}

.outline-2 h2 {
    font-size: 1em;
}

.outline-3 h3 {
    font-size: 1em;
    font-style: normal;
}

.outline-2 .section-number-2 {
    font-size: 1em;
}

.outline-3 .section-number-3 {
    font-size: 1em;
}

.timestamp,
.timestamp-kwd {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
    background-color: var(--back-white);
    border-radius: 1px;
}

.todo,
.done {
    padding: 0.1em 0.2em;
    border-style: solid;
    border-width: 1px;
    border-color: var(--back-light);
    border-radius: 1px;
    font-family: "Fira Code", sans;
    font-variant: all-small-caps;
    font-size: 1em;
    font-style: normal;
    letter-spacing: 2px;
    background-image: none;
    line-height: 1;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0.1em 0.5em;
    background-color: var(--back-white);
    background-color: transparent;
    border: none;
    font-weight: bold;
}

.todo:hover,
.done:hover {
    background-color: var(--back-light);
    background-image: none;
}

.todo:not(.active),
.done:not(.active) {
    border-color: var(--back-white);
}

.todo.active,
.done.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground);
}

.todo.active:hover,
.done.active:hover {
    background-color: var(--back-light);
    background-image: none;
    color: var(--text-dark);
}

.outline-2,
.outline-3,
.outline-4 {
    contain: layout;
}

.outline-2 .todo,
.outline-2 .done,
.outline-3 .todo,
.outline-3 .done,
.outline-4 .todo,
.outline-4 .done {
    font-size: 1em;
}

.todo {
    color: #ee3333;
}

.done {
    color: var(--text-light);
}

.tag > span {
    padding: 0.1em 0.2em;
    border-style: solid;
    border-width: 1px;
    border-color: var(--back-light);
    border-radius: 1px;
    font-family: "Fira Code", sans;
    font-variant: all-small-caps;
    font-size: 1em;
    font-style: normal;
    letter-spacing: 2px;
    background-image: none;
    line-height: 1;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0.1em 0.5em;
    background-color: var(--back-white);
    border-radius: 100px;
}

.tag > span:hover {
    background-color: var(--back-light);
    background-image: none;
}

.tag > span:not(.active) {
    border-color: var(--back-white);
}

.tag > span.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground);
}

.tag > span.active:hover {
    background-color: var(--back-light);
    background-image: none;
    color: var(--text-dark);
}

.priority {
    color: var(--text-light);
    font-family: SFMono-Regular, Consolas, Liberation Mono, Menlo, monospace;
}

.footref {
    text-shadow: none;
}

.footpara {
    display: inline;
}

.footdef {
    margin-bottom: 1em;
}

th.org-right {
    text-align: center;
}

th.org-left {
    text-align: center;
}

th.org-center {
    text-align: center;
}

td.org-right {
    text-align: right;
}

td.org-left {
    text-align: left;
}

td.org-center {
    text-align: center;
}

div.org-center {
    text-align: center;
}

/* span.acr { */
/*     font-variant-caps: all-small-caps; */
/*     letter-spacing: 0.1em; */
/* } */

.music-track {
    display: flex;
    justify-content: center;
    align-items: center;
    flex-wrap: wrap;
}

.music-track img {
    height: 6rem;
    margin-right: 2rem;
}

.music-track a {
    text-decoration: none;
}

.music-track span {
    min-width: 35%;
}

div.table {
    position: relative;
}

div.table .gutter {
    left: calc(20px - 2.5rem);
    padding-top: 18px;
}

div.table .tabular {
    max-width: 100%;
    overflow-x: auto;
}

table {
    border-color: var(--text-light);
    border-left: transparent;
    border-right: transparent;
    border-style: solid;
    border-width: 2px;
    border-collapse: collapse;
    font-size: 1em;
    font-family: "Fira Code", sans;
    margin: 20px;
    padding: 20px;
}

table thead {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
    font-size: 1em;
}

table thead tr th {
    padding: 4px 10px;
    background-color: #9991;
}

table thead tr:last-of-type th {
    border-bottom: solid 1px var(--text-light);
}

table tr, table th, table td {
    border: none;
}

table tbody tr td {
    border-top: 0;
    padding: 0 10px;
}

table tr {
    line-height: 1.5;
}

table caption {
    margin-bottom: 10px;
    min-width: 20em;
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.6;
    color: var(--text-gray);
}

table caption .table-number {
    font-family: "Fira Code", sans;
    font-weight: normal;
    font-style: normal;
    font-size: 1em;
    line-height: 1.5;
    color: var(--text-light);
}

::-webkit-scrollbar {
    width: 10px;
    height: 8px;
}

::-webkit-scrollbar-track {
    background: #9992;
}

::-webkit-scrollbar-thumb {
    background: #ccc;
}

::-webkit-scrollbar-thumb:hover {
    background: #888;
}

@media (min-width: 1500px) {
    #table-of-contents {
        position: fixed;
        width: 18rem;
        right: 1rem;
        top: 0;
        padding: 1em;
        line-height: 1.5;
        margin-top: 4rem;
    }

    #table-of-contents h2 {
        margin-top: 0;
    }

    #table-of-contents #text-table-of-contents {
        position: relative;
    }

    #table-of-contents #text-table-of-contents::before, #table-of-contents #text-table-of-contents::after {
        position: absolute;
        content: '';
        width: calc(100% - 10px);
        height: 0.7rem;
        left: 0;
        z-index: 1;
    }

    #table-of-contents #text-table-of-contents::before {
        top: 0;
        background: linear-gradient(180deg, var(--back-light) 0%, var(--back-light) 35%, rgba(0, 0, 0, 0) 100%);
    }

    #table-of-contents #text-table-of-contents::after {
        bottom: 0;
        background: linear-gradient(0deg, var(--back-light) 0%, var(--back-light) 35%, rgba(0, 0, 0, 0) 100%);
    }

    #table-of-contents #text-table-of-contents > ul {
        list-style: none;
        padding: 0;
        margin: 0;
        max-height: calc(100vh - 5rem - 50px);
        overflow-y: auto;
        overflow-x: hidden;
        scrollbar-width: thin;
    }

    #table-of-contents #text-table-of-contents > ul ul {
        padding-left: 2em;
    }

    #table-of-contents #text-table-of-contents > ul ul.active {
        display: inline-block;
    }

    #table-of-contents #text-table-of-contents > ul li.active > ul {
        display: inline-block;
    }

    #table-of-contents #text-table-of-contents > ul li.active > label a, #table-of-contents #text-table-of-contents > ul li.active > a {
        color: var(--text-dark);
    }

    #table-of-contents #text-table-of-contents > ul li.active > input:not(:checked) ~ label::after {
        transform: rotate(90deg);
        top: 5px;
        opacity: 0.35;
    }

    #table-of-contents #text-table-of-contents > ul > li:last-child {
        margin-bottom: 2rem;
    }
}

@media (min-width: 1440px) {
    #table-of-contents {
        width: 20rem;
        right: 2rem;
    }
}

@media (min-width: 1640px) {
    #table-of-contents {
        right: 5rem;
    }
}

@media (min-width: 2000px) {
    #table-of-contents {
        width: 25rem;
    }
}

#table-of-contents #text-table-of-contents ul {
    width: 100%;
}

#table-of-contents #text-table-of-contents > ul ul {
    display: none;
}

#table-of-contents #text-table-of-contents li input[type=checkbox] {
    display: none;
}

#table-of-contents #text-table-of-contents li label {
    display: inline-block;
    width: 100%;
    position: relative;
}

#table-of-contents #text-table-of-contents li a {
    display: inline-block;
    color: var(--text-gray);
    text-decoration: none !important;
    text-shadow: none;
    background: none !important;
}

#table-of-contents #text-table-of-contents li label::after {
    /* content: "\25b6"; */
    color: var(--text-gray);
    margin-left: 0.5em;
    font-size: 1em;
    display: inline-block;
    position: absolute;
    top: 3.4px;
    left: -20px;
    opacity: 0;
}

#table-of-contents #text-table-of-contents li input:checked ~ ul {
    display: inline-block !important;
}

#table-of-contents #text-table-of-contents li input:checked ~ label a {
    font-weight: bold;
}

#table-of-contents #text-table-of-contents li input:checked ~ label::after {
    transform: rotate(90deg);
    top: 5px;
}

#table-of-contents #text-table-of-contents li::before {
    content: "" !important;
}

.page-tags a {
    padding: 0.1em 0.2em;
    border-style: solid;
    border-width: 1px;
    border-color: var(--back-light);
    border-radius: 1px;
    font-family: "Fira Code", sans;
    font-variant: all-small-caps;
    font-size: 1em;
    font-style: normal;
    letter-spacing: 2px;
    background-image: none;
    line-height: 1;
    white-space: nowrap;
    vertical-align: middle;
    padding: 0.1em 0.5em;
    background-color: var(--back-white);
    margin-right: 5px;
    line-height: 3em;
}

.page-tags a:hover {
    background-color: var(--back-light);
    background-image: none;
}

.page-tags a:not(.active) {
    border-color: var(--back-white);
}

.page-tags a.active {
    text-shadow: none;
    text-decoration: none;
    color: var(--back-white);
    background-color: var(--code-foreground);
}

.page-tags a.active:hover {
    background-color: var(--back-light);
    background-image: none;
    color: var(--text-dark);
}

@media print {
    h2 {
        page-break-before: always;
    }

    h1, h2, h3, h4, h5 {
        page-break-after: avoid;
    }

    #switch-label {
        display: none;
    }

    #content, #page-header {
        margin-top: 0;
    }

    #table-of-contents #text-table-of-contents > ul ul {
        display: inline-block;
    }

    #table-of-contents #text-table-of-contents > ul a::after {
        content: leader(".") target-counter(attr(href), page);
    }

    #table-of-contents #text-table-of-contents li label::after {
        display: none;
    }

    img {
        filter: none;
    }
}

@page {
    size: auto;
    margin-top: 4mm;
    margin-bottom: 4mm;
}

a[aria-hidden] {
    display: none;
}
</style>
</head>
<body>
<input type='checkbox' id='theme-switch'><div id='page'><label id='switch-label' for='theme-switch'></label><div id="content">
<nav id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#orga77f42f">1. Spring MVC Process Overview</a>
<ul>
<li><a href="#orgc4cb87e">1.1. Spring MVC Process</a></li>
<li><a href="#org396e785">1.2. DispatcherServlet</a></li>
</ul>
</li>
<li><a href="#orge04840e">2. HandlerMapping and HandlerAdapter</a>
<ul>
<li><a href="#org1ed0e74">2.1. HandlerMapping</a></li>
<li><a href="#orgabc3a98">2.2. HandlerAdapter</a></li>
</ul>
</li>
<li><a href="#org749aabd">3. ViewResoIver</a>
<ul>
<li><a href="#orga8d10e2">3.1. ViewResolver Overview</a></li>
<li><a href="#org9c17a53">3.2. Resolution Process</a></li>
<li><a href="#orgd10b486">3.3. Usual ViewResolver</a></li>
<li><a href="#orgbba9b9a">3.4. ViewResolver Chain</a></li>
</ul>
</li>
</ul>
</div>
</nav>

<figure id="org8ccfce5">
<img src="/spring/10-0.png" alt="10-0.png">

</figure>

<div id="outline-container-orga77f42f" class="outline-2">
<h2 id="orga77f42f"><span class="section-number-2">1.</span> Spring MVC Process Overview</h2>
<div class="outline-text-2" id="text-1">
<p>
ä¸Šå›¾æ˜¯ Spring ä¸Ž Servlet äº¤äº’çš„å¤§ä½“æ¦‚è§ˆ, ä½†æ˜¯ The devil is in the details. DispatcherServlet åˆ†å‘äº†è¯·æ±‚ä¹‹åŽçš„ç»†èŠ‚æ»¡æ»¡, ä¸‹é¢å°è¯•æ·±å…¥ Spring MVC çš„æºç , ç†è§£ä¸€ä¸‹ Spring MVC æµç¨‹åŽŸç†.
</p>
</div>

<div id="outline-container-orgc4cb87e" class="outline-3">
<h3 id="orgc4cb87e"><span class="section-number-3">1.1.</span> Spring MVC Process</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Spring MVC æ¡†æž¶æ•´ä½“çš„è¯·æ±‚æµç¨‹å¦‚å›¾æ‰€ç¤º, è¯¥å›¾æ˜¾ç¤ºäº†ç”¨æˆ·ä»Žè¯·æ±‚åˆ°å“åº”çš„å®Œæ•´æµç¨‹.
</p>

<p>
(1) Client request è¯·æ±‚, è¯¥è¯·æ±‚è¢« DispatcherServlet å¤„ç†.
</p>

<p>
(2) DispatcherServlet è¯·æ±‚ HandlerMapping æŸ¥æ‰¾ Handler.
</p>

<p>
(3) HandlerMapping æ ¹æ®é…ç½®æŸ¥æ‰¾ç›¸å…³çš„ HandlerExecutionChain, è¿”å›žç»™ DispatcherServlet.
</p>

<p>
(4) DispatcherServlet è¯·æ±‚ HandlerAdapter æ‰§è¡Œç›¸åº”çš„ Handler (æˆ–ç§°ä¸º Controller).
</p>

<p>
(5) HandlerAdapter æ‰§è¡Œ Handler.
</p>

<p>
(6) Handler æ‰§è¡Œå®Œæ¯•åŽä¼šè¿”å›ž ModelAndView ç»™ HandlerAdapter.
</p>


<figure id="org8af7cc1">
<img src="/spring/10-1.png" alt="10-1.png">

<figcaption><span class="figure-number">Figure 1: </span>Spring MVC æ¡†æž¶æ•´ä½“çš„è¯·æ±‚æµç¨‹</figcaption>
</figure>

<p>
(7) HandlerAdapter æŽ¥æ”¶åˆ° Handler è¿”å›žçš„ ModelAndView åŽ, å°†å…¶è¿”å›žç»™ DispatcherServlet.
</p>

<p>
(8) DispatcherServlet æŽ¥æ”¶åˆ° ModelAndView å¯¹è±¡åŽ, è¯·æ±‚ ViewResolver å¯¹è§†å›¾è¿›è¡Œè§£æž.
</p>

<p>
(9) ViewResolver æ ¹æ® View ä¿¡æ¯åŒ¹é…ç›¸åº”çš„è§†å›¾ç»“æžœ, è¿”å›žç»™ DispatcherServlet.
</p>

<p>
(10) DispatcherServlet æ”¶åˆ° View åŽ, å¯¹è§†å›¾è¿›è¡Œæ¸²æŸ“, å°† Model ä¸­çš„æ¨¡åž‹æ•°æ®å¡«å……åˆ° View è§†å›¾ä¸­çš„ request åŸŸ, ç”Ÿæˆæœ€ç»ˆçš„è§†å›¾.
</p>

<p>
(11) DispatcherServlet è¿”å›žè¯·æ±‚ç»“æžœç»™ Client.
</p>

<p>
HandlerAdapter æ‰§è¡Œ Handler(æˆ–ç§°ä¸º Controller) çš„è¿‡ç¨‹ä¸­, Spring è¿˜åšäº†ä¸€äº›é¢å¤–çš„å·¥ä½œ, å…·ä½“å¦‚å›¾æ‰€ç¤º.
</p>

<dl class="org-dl">
<dt>HttpMessageConverter</dt><dd>å°†è¯·æ±‚ä¿¡æ¯, æ¯”å¦‚: JSON, XML ç­‰æ•°æ®è½¬æ¢æˆä¸€ä¸ªå¯¹è±¡, å¹¶å°†å¯¹è±¡è½¬æ¢ä¸ºæŒ‡å®šçš„å“åº”ä¿¡æ¯.</dd>

<dt>Data Coversion</dt><dd>å¯¹è¯·æ±‚çš„ä¿¡æ¯è¿›è¡Œè½¬æ¢, æ¯”å¦‚, String è½¬æ¢ä¸º Integerx Double ç­‰.</dd>

<dt>Data Format</dt><dd>å¯¹è¯·æ±‚æ¶ˆæ¯è¿›è¡Œæ•°æ®æ ¼å¼åŒ–, æ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ ¼å¼åŒ–æ•°æ®æˆ–è€…æ ¼å¼åŒ–æ—¥æœŸç­‰.</dd>

<dt>Data Validation</dt><dd>éªŒè¯è¯·æ±‚æ•°æ®çš„æœ‰æ•ˆæ€§, å¹¶å°†éªŒè¯çš„ç»“æžœå­˜å‚¨åˆ° BindingResult æˆ– Error ä¸­.</dd>
</dl>


<figure id="orgba63a08">
<img src="/spring/10-2.png" alt="10-2.png">

<figcaption><span class="figure-number">Figure 2: </span>æ•°æ®è½¬æ¢, æ ¼å¼åŒ–, æ ¡éªŒ</figcaption>
</figure>

<p>
ä»¥ä¸Šå°±æ˜¯ Sring MVC è¯·æ±‚åˆ°å“åº”çš„æ•´ä¸ªå·¥ä½œæµç¨‹, ä¸­é—´ä½¿ç”¨åˆ°çš„ç»„ä»¶æœ‰ DispatcherServlet, HandlerMapping, HandlerAdapter, Handler or Controller, ViewResolver å’Œ View ç­‰.
</p>
</div>
</div>

<div id="outline-container-org396e785" class="outline-3">
<h3 id="org396e785"><span class="section-number-3">1.2.</span> DispatcherServlet</h3>
<div class="outline-text-3" id="text-1-2">
<p>
DispatcherServlet çš„ä½œç”¨å°±æ˜¯æŽ¥å—ç”¨æˆ·è¯·æ±‚, ç„¶åŽç»™ç”¨æˆ·å“åº”ç»“æžœ. å®ƒçš„ä½œç”¨ç›¸å½“äºŽä¸€ä¸ªè½¬å‘å™¨æˆ–ä¸­å¤®å¤„ç†å™¨, æŽ§åˆ¶æ•´ä¸ªæµç¨‹çš„æ‰§è¡Œ, å¯¹å„ä¸ªç»„ä»¶è¿›è¡Œç»Ÿä¸€è°ƒåº¦, ä»¥é™ä½Žç»„ä»¶ä¹‹é—´çš„è€¦åˆæ€§, æœ‰åˆ©äºŽç»„ä»¶ä¹‹é—´çš„æ‰©å±•.
</p>

<p>
DispatcherServlet éƒ¨åˆ†çš„æºç å¦‚ä¸‹æ‰€ç¤º:
</p>

<details id='org830d0be' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org830d0be'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">DispatcherServlet</span> <span class="org-keyword">extends</span> <span class="org-type">FrameworkServlet</span> {
    <span class="org-comment-delimiter">// </span><span class="org-comment">static variable ...</span>
    <span class="org-comment-delimiter">//</span>
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">LocaleResolver</span> <span class="org-variable-name">localeResolver</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">ThemeResolver</span> <span class="org-variable-name">themeResolver</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;<span class="org-type">HandlerMapping</span>&gt; <span class="org-variable-name">handlerMappings</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;<span class="org-type">HandlerAdapter</span>&gt; <span class="org-variable-name">handlerAdapters</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;<span class="org-type">HandlerExceptionResolver</span>&gt; <span class="org-variable-name">handlerExceptionResolvers</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">RequestToViewNameTranslator</span> <span class="org-variable-name">viewNameTranslator</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">FlashMapManager</span> <span class="org-variable-name">flashMapManager</span>;
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">private</span> <span class="org-type">List</span>&lt;<span class="org-type">ViewResolver</span>&gt; <span class="org-variable-name">viewResolvers</span>;


    <span class="org-keyword">protected</span> <span class="org-type">void</span> <span class="org-function-name">initStrategies</span>(<span class="org-type">ApplicationContext</span> <span class="org-variable-name">context</span>) {
        <span class="org-keyword">this</span>.initMultipartResolver(context);
        <span class="org-keyword">this</span>.initLocaleResolver(context);
        <span class="org-keyword">this</span>.initThemeResolver(context);
        <span class="org-keyword">this</span>.initHandlerMappings(context);
        <span class="org-keyword">this</span>.initHandlerAdapters(context);
        <span class="org-keyword">this</span>.initHandlerExceptionResolvers(context);
        <span class="org-keyword">this</span>.initRequestToViewNameTranslator(context);
        <span class="org-keyword">this</span>.initViewResolvers(context);
        <span class="org-keyword">this</span>.initFlashMapManager(context);
    }

    <span class="org-comment-delimiter">// </span><span class="org-comment">other methods ...</span>
}
</pre>
</div>
        </details>

<p>
DispatcherServlet ç±»çš„ç±»ç»§æ‰¿ç»“æž„å¦‚å›¾æ‰€ç¤º.
</p>


<figure id="orga47aaa1">
<img src="/spring/10-3.png" alt="10-3.png">

<figcaption><span class="figure-number">Figure 3: </span>DispatcherServlet çš„ç±»ç»“æž„</figcaption>
</figure>

<p>
ç”±å›¾å¯çŸ¥, DispatcherServlet æœ€ä¸Šå±‚çš„çˆ¶ç±»æ˜¯ Servlet ç±», ä¹Ÿå°±æ˜¯è¯´ DispatcherServlet ä¹Ÿæ˜¯ä¸€ä¸ª Servlet, ä¸”åŒ…å«æœ‰ deGet() å’Œ doPost() æ–¹æ³•. initStrategies æ–¹æ³•åœ¨ WebApplicationContext åˆå§‹åŒ–åŽè‡ªåŠ¨æ‰§è¡Œ, è‡ªåŠ¨æ‰«æä¸Šä¸‹æ–‡çš„ Bean, æ ¹æ®åç§°æˆ–è€…ç±»åž‹åŒ¹é…çš„æœºåˆ¶æŸ¥æ‰¾è‡ªå®šä¹‰çš„ç»„ä»¶, å¦‚æžœæ²¡æœ‰æ‰¾åˆ°, ä¼šè£…é… Spring çš„é»˜è®¤ç»„ä»¶. Spring çš„é»˜è®¤ç»„ä»¶åœ¨ org.springframework.web.servlet è·¯å¾„ä¸‹çš„ DispatcherServlet.properties é…ç½®æ–‡ä»¶ä¸­é…ç½®. DispatcherServlet.properties çš„å…·ä½“ä»£ç å¦‚ä¸‹:
</p>

<details id='org930be16' class='code' open><summary><span class="lang">Configuration File</span></summary>
        <div class='gutter'>
        <a href='#org930be16'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-conf"><span class="org-comment-delimiter"># </span><span class="org-comment">Default implementation classes for DispatcherServlet's strategy interfaces.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Used as fallback when no matching beans are found in the DispatcherServlet context.</span>
<span class="org-comment-delimiter"># </span><span class="org-comment">Not meant to be customized by application developers.</span>

<span class="org-variable-name">org.springframework.web.servlet.LocaleResolver</span>=org.springframework.web.servlet.i18n.AcceptHeaderLocaleResolver

<span class="org-variable-name">org.springframework.web.servlet.ThemeResolver</span>=org.springframework.web.servlet.theme.FixedThemeResolver

<span class="org-variable-name">org.springframework.web.servlet.HandlerMapping</span>=org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping,\
    org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerMapping,\
    org.springframework.web.servlet.function.support.RouterFunctionMapping

<span class="org-variable-name">org.springframework.web.servlet.HandlerAdapter</span>=org.springframework.web.servlet.mvc.HttpRequestHandlerAdapter,\
    org.springframework.web.servlet.mvc.SimpleControllerHandlerAdapter,\
    org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter,\
    org.springframework.web.servlet.function.support.HandlerFunctionAdapter


<span class="org-variable-name">org.springframework.web.servlet.HandlerExceptionResolver</span>=org.springframework.web.servlet.mvc.method.annotation.ExceptionHandlerExceptionResolver,\
    org.springframework.web.servlet.mvc.annotation.ResponseStatusExceptionResolver,\
    org.springframework.web.servlet.mvc.support.DefaultHandlerExceptionResolver

<span class="org-variable-name">org.springframework.web.servlet.RequestToViewNameTranslator</span>=org.springframework.web.servlet.view.DefaultRequestToViewNameTranslator

<span class="org-variable-name">org.springframework.web.servlet.ViewResolver</span>=org.springframework.web.servlet.view.InternalResourceViewResolver

<span class="org-variable-name">org.springframework.web.servlet.FlashMapManager</span>=org.springframework.web.servlet.support.SessionFlashMapManager
</pre>
</div>
        </details>

<p>
DispatcherServlet ç±»åŒ…å«è®¸å¤šæ–¹æ³•, å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹ä¸‰ç±»:
</p>

<p>
(1) åˆå§‹åŒ–ç›¸å…³å¤„ç†ç±»çš„æ–¹æ³•, æ¯”å¦‚ initMultipartResolver(), initLocaleResolver() ç­‰.
</p>

<p>
(2) å“åº” HTTP è¯·æ±‚çš„æ–¹æ³•.
</p>

<p>
(3) æ‰§è¡Œå¤„ç†è¯·æ±‚é€»è¾‘çš„æ–¹æ³•.
</p>

<p>
DispatcherServlet è£…é…çš„ç»„ä»¶, å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤º:
</p>

<ul class="org-ul">
<li>LocaleResolver: æœ¬åœ°åŒ–è§£æž, åªå…è®¸ä¸€ä¸ªå®žä¾‹. å› ä¸º Spring æ”¯æŒå›½é™…åŒ–, æ‰€ä»¥ LocalResover è§£æžå®¢æˆ·ç«¯çš„ Locale ä¿¡æ¯ä»Žè€Œæ–¹ä¾¿è¿›è¡Œå›½é™…åŒ–. å¦‚æžœæ²¡æœ‰æ‰¾è‡³, ä½¿ç”¨é»˜è®¤çš„å®žçŽ°ç±» AcceptHeaderLocaleResolveH ä¸ºè¯¥ç±»åž‹çš„ç»„ä»¶.</li>

<li>ThemeResovler: ä¸»é¢˜è§£æž, åªå…è®¸ä¸€ä¸ªå®žä¾‹. é€šè¿‡å®ƒæ¥å®žçŽ°ä¸€ä¸ªé¡µé¢å¤šå¥—é£Žæ ¼, å³å¸¸è§çš„ç±»ä¼¼äºŽè½¯ä»¶çš®è‚¤æ•ˆæžœ. å¦‚æžœæ²¡æœ‰æ‰¾åˆ°, ä½¿ç”¨é»˜è®¤çš„å®žçŽ°ç±» FixedThemeResolver ä½œä¸ºè¯¥ç±»åž‹çš„ç»„ä»¶.</li>

<li>HandlerMapping: è¯·æ±‚åˆ°å¤„ç†å™¨çš„æ˜ å°„, å…è®¸å¤šä¸ªå®žä¾‹. å¦‚æžœæ˜ å°„æˆåŠŸè¿”å›žä¸€ä¸ª HandlerExecutionChain å¯¹è±¡(åŒ…å«ä¸€ä¸ª Handler å¤„ç†å™¨ï¼»é¡µé¢æŽ§åˆ¶å™¨ï¼½) å¯¹è±¡, å¤šä¸ª Handlerlnterceptoi- æ‹¦æˆªå™¨) å¯¹è±¡ï¼›å¦‚æžœ detectHandlerMappings çš„å±žæ€§ä¸º true(é»˜è®¤ä¸º true), åˆ™æ ¹æ®ç±»åž‹åŒ¹é…æœºåˆ¶æŸ¥æ‰¾ä¸Šä¸‹æ–‡åŠ Spring å®¹å™¨ä¸­æ‰€æœ‰ç±»åž‹ä¸º HandlerMapping çš„ Bean, å°†å®ƒä»¬ä½œä¸ºè¯¥ç±»åž‹çš„ç»„ä»¶. å¦‚æžœ detectHandlerMappings çš„å±žæ€§ä¸º false, åˆ™æŸ¥æ‰¾åä¸º handlerMapping, ç±»åž‹ä¸º HandlerMapping çš„ Bean ä½œä¸ºè¯¥ç±»åž‹ç»„ä»¶. å¦‚æžœä»¥ä¸Šä¸¤ç§æ–¹å¼éƒ½æ²¡æœ‰æ‰¾åˆ°, åˆ™ä½¿ç”¨ BeanNameUrlHandlerMapping å®žçŽ°ç±»åˆ›å»ºè¯¥ç±»åž‹çš„ç»„ä»¶. BeanNameUrlHandlerMapping å°† URL ä¸Ž Bean åå­—æ˜ å°„, æ˜ å°„æˆåŠŸçš„ Bean å°±æ˜¯æ­¤å¤„çš„å¤„ç†å™¨.</li>

<li>HandlerAdapter: å…è®¸å¤šä¸ªå®žä¾‹, HandlerAdapter å°†ä¼šæŠŠå¤„ç†å™¨åŒ…è£…ä¸ºé€‚é…å™¨, ä»Žè€Œæ”¯æŒå¤šç§ç±»åž‹çš„å¤„ç†å™¨, å³é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„åº”ç”¨, ä»Žè€Œå¾ˆå®¹æ˜“æ”¯æŒå¾ˆå¤šç±»åž‹çš„å¤„ç†å™¨. å¦‚ SimpleControllerHandlerAdapter å°†å¯¹å®žçŽ°äº† Controller æŽ¥å£ çš„ Bean è¿›è¡Œé€‚é…, å¹¶ä¸”æŒ‰å¤„ç†å™¨çš„ handleRequest æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¤„ç†. é»˜è®¤ä½¿ç”¨ DispatcherServlet.properties é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ä¸‰ä¸ªå®žçŽ°ç±»åˆ†åˆ«åˆ›å»ºä¸€ä¸ªé€‚é…å™¨, å¹¶å°†å…¶æ·»åŠ åˆ°é€‚é…å™¨åˆ—è¡¨ä¸­.</li>

<li>HandlerExceptionResolver: å…è®¸å¤šä¸ªå®žä¾‹. å¤„ç†å™¨å¼‚å¸¸è§£æžå¯ä»¥å°†å¼‚å¸¸æ˜ å°„åˆ°ç›¸åº”çš„ç»Ÿä¸€é”™è¯¯ç•Œé¢, ä»Žè€Œæ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„ç•Œé¢(è€Œä¸æ˜¯ç»™ç”¨æˆ·çœ‹åˆ°å…·ä½“çš„é”™è¯¯ä¿¡æ¯). é»˜è®¤ä½¿ç”¨ DispatcherServlet.properties é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„å®žçŽ°ç±».</li>

<li>ViewNameTranslator: åªå…è®¸ä¸€ä¸ªå®žä¾‹. é»˜è®¤ä½¿ç”¨ DefaultRequestToViewNameTranslatoH ä¸ºè¯¥ç±»åž‹çš„ç»„ä»¶.</li>

<li>ViewResolver: å…è®¸å¤šä¸ªå®žä¾‹. ViewResolver å°†æŠŠé€»è¾‘è§†å›¾åè§£æžä¸ºå…·ä½“çš„ View, é€šè¿‡è¿™ç§ç­–ç•¥æ¨¡å¼, å¾ˆå®¹æ˜“æ›´æ¢å…¶ä»–è§†å›¾æŠ€æœ¯, å¦‚ IntemalResourceViewResolver# é€»è¾‘è§†å›¾åæ˜ å°„ä¸º JSP è§†å›¾.</li>

<li>FlashMap æ˜ å°„ç®¡ç†å™¨ï¼šæŸ¥æ‰¾åä¸º FlashMapManager, ç±»åž‹ä¸º SessionFlashMapManager çš„ bean ä½œä¸ºè¯¥ç±»åž‹ç»„ä»¶, ç”¨äºŽç®¡ç† FlashMap, å³æ•°æ®é»˜è®¤å­˜å‚¨åœ¨ HttpSession ä¸­.</li>
</ul>

<p>
éœ€è¦æ³¨æ„çš„æ˜¯, DispatcherServlet è£…é…çš„å„ç§ç»„ä»¶, æœ‰äº›åªå…è®¸ä¸€ä¸ªå®žä¾‹, æœ‰äº›åˆ™å…è®¸å¤šä¸ªå®žä¾‹. å¦‚æžœåŒä¸€ä¸ªç±»åž‹çš„ç»„ä»¶å­˜åœ¨å¤šä¸ª, å¯ä»¥é€šè¿‡ Order å±žæ€§ç¡®å®šä¼˜å…ˆçº§çš„é¡ºåº, å€¼è¶Šå°çš„ä¼˜å…ˆçº§è¶Šé«˜.
</p>
</div>
</div>
</div>

<div id="outline-container-orge04840e" class="outline-2">
<h2 id="orge04840e"><span class="section-number-2">2.</span> HandlerMapping and HandlerAdapter</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org1ed0e74" class="outline-3">
<h3 id="org1ed0e74"><span class="section-number-3">2.1.</span> HandlerMapping</h3>
<div class="outline-text-3" id="text-2-1">
<p>
å¤„ç†æ˜ å°„å™¨ HandlerMapping æ˜¯æŒ‡è¯·æ±‚åˆ°å¤„ç†å™¨çš„æ˜ å°„æ—¶, å…è®¸æœ‰å¤šä¸ªå®žä¾‹. å¦‚æžœæ˜ å°„æˆåŠŸè¿”å›žä¸€ä¸ª HandlerExecutionChain å¯¹è±¡(åŒ…å«ä¸€ä¸ª Handler å¤„ç†å™¨ï¼»é¡µé¢æŽ§åˆ¶å™¨ï¼½å¯¹è±¡, å¤šä¸ª Handlerinterceptor æ‹¦æˆªå™¨) å¯¹è±¡. Spring MVC æä¾›äº†å¤šä¸ªå¤„ç†æ˜ å°„å™¨ HandlerMapping å®žçŽ°ç±», ä¸‹é¢åˆ†åˆ«è¿›è¡Œè¯´æ˜Ž.
</p>

<p>
(1) BeanNamellrlHandlerMapping
</p>

<p>
BeanNameUrlHandlerMapping æ˜¯é»˜è®¤æ˜ å°„å™¨, åœ¨ä¸é…ç½®çš„æƒ…å†µä¸‹, é»˜è®¤å°±ä½¿ç”¨è¿™ä¸ªç±»æ¥æ˜ å°„è¯·æ±‚. å…¶æ˜ å°„è§„åˆ™æ˜¯æ ¹æ®è¯·æ±‚çš„ URL ä¸Ž Spring å®¹å™¨ä¸­å®šä¹‰çš„å¤„ç†å™¨ bean çš„ name å±žæ€§å€¼è¿›è¡ŒåŒ¹é…, ä»Žè€Œåœ¨ Spring å®¹å™¨ä¸­æ‰¾åˆ° Handler (å¤„ç†å™¨) çš„ bean å®žä¾‹.
</p>

<details id='orgac4aca3' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#orgac4aca3'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-comment-delimiter">&lt;!--</span><span class="org-comment">Default Handler Mapping</span><span class="org-comment-delimiter">--&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.handler.BeanNameUrlHandlerMapping"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>

<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"testController"</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"/hello"</span>
      <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"self.defined.Controller"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
(2) SimplellrlHandlerMapping
</p>

<p>
SimpleUrlHandlerMapping æ ¹æ®æµè§ˆå™¨ URL åŒ¹é… prop æ ‡ç­¾ä¸­çš„ key, é€šè¿‡ key æ‰¾åˆ°å¯¹åº”çš„ Controller.
</p>

<details id='org3e9c833' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org3e9c833'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.handler.SimpleUrlHandlerMapping"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"mapping"</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">props</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">prop</span> <span class="org-nxml-attribute-local-name">key</span>=<span class="org-string">"/hello"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">helloController</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">prop</span><span class="org-nxml-tag-delimiter">&gt;</span>
      <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">prop</span> <span class="org-nxml-attribute-local-name">key</span>=<span class="org-string">"/test"</span><span class="org-nxml-tag-delimiter">&gt;</span><span class="org-nxml-text">testController</span><span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">prop</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">props</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"testController"</span>
      <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"/test"</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"self.define.TestController"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
ä¸Šè¿°é…ç½®äº†ä¸¤ä¸ªä¸åŒçš„ URL æ˜ å°„, å¯¹åº”äºŽåŒä¸€ä¸ª Controller é…ç½®. ä¹Ÿå°±æ˜¯è¯´, åœ¨æµè§ˆå™¨ä¸­å‘èµ·ä¸¤ä¸ªä¸åŒçš„ URL è¯·æ±‚, ä¼šå¾—åˆ°ç›¸åŒçš„å¤„ç†ç»“æžœ.
</p>
</div>
</div>

<div id="outline-container-orgabc3a98" class="outline-3">
<h3 id="orgabc3a98"><span class="section-number-3">2.2.</span> HandlerAdapter</h3>
<div class="outline-text-3" id="text-2-2">
<p>
å¤„ç†é€‚é…å™¨(HandlerAdapter) å…è®¸å¤šä¸ªå®žä¾‹, HandlerAdapter å°†ä¼šæŠŠå¤„ç†å™¨åŒ…è£…ä¸ºé€‚é…å™¨, ä»Žè€Œæ”¯æŒå¤šç§ç±»åž‹çš„å¤„ç†å™¨, å³é€‚é…å™¨è®¾è®¡æ¨¡å¼çš„åº”ç”¨, ä»Žè€Œå¾ˆå®¹æ˜“æ”¯æŒå¤šç§ç±»åž‹çš„å¤„ç†å™¨. å¦‚ SimpleControllerHandlerAdapter å°†å¯¹å®žçŽ°äº† Controller æŽ¥å£çš„ Bean è¿›è¡Œé€‚é…, å¹¶ä¸”æŒ‰å¤„ç†å™¨çš„ handleRequest æ–¹æ³•è¿›è¡ŒåŠŸèƒ½å¤„ç†. é»˜è®¤ä½¿ç”¨ DispatcherServlet.properties é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„ä¸‰ä¸ªå®žçŽ°ç±»åˆ†åˆ«åˆ›å»ºä¸€ä¸ªé€‚é…å™¨, å¹¶å°†å…¶æ·»åŠ åˆ°é€‚é…å™¨åˆ—è¡¨ä¸­.
</p>

<p>
Spring MVC æä¾›äº†å¤šä¸ªå¤„ç†é€‚é…å™¨(HandlerAdapter) å®žçŽ°ç±», åˆ†åˆ«è¯´æ˜Žå¦‚ä¸‹.
</p>

<p>
(1) SimpleControllerHandlerAdapter
</p>

<p>
SimpleControllerHandlerAdapter æ”¯æŒæ‰€æœ‰å®žçŽ° Controller æŽ¥å£çš„ Handler æŽ§åˆ¶å™¨, æ˜¯ Controller å®žçŽ°ç±»çš„é€‚é…å™¨ç±», å…¶æœ¬è´¨æ˜¯æ‰§è¡Œ Controller ç±»ä¸­çš„ handleRequest æ–¹æ³•. SimpleControllerHandlerAdapter çš„æºç å¦‚ä¸‹:
</p>

<details id='orgca49bb1' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgca49bb1'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">SimpleControllerHandlerAdapter</span>
    <span class="org-keyword">implements</span> <span class="org-type">HandlerAdapter</span> {
    <span class="org-keyword">public</span> SimpleControllerHandlerAdapter() {
    }

    <span class="org-keyword">public</span> <span class="org-type">boolean</span> <span class="org-function-name">supports</span>(<span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> handler <span class="org-keyword">instanceof</span> Controller;
    }

    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">public</span> <span class="org-type">ModelAndView</span> <span class="org-function-name">handle</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                               <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>,
                               <span class="org-type">Object</span> <span class="org-variable-name">handler</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
        <span class="org-keyword">return</span> ((<span class="org-type">Controller</span>)handler).handleRequest(request, response);
    }

    <span class="org-keyword">public</span> <span class="org-type">long</span> <span class="org-function-name">getLastModified</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                <span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> handler <span class="org-keyword">instanceof</span> LastModified ?
            ((<span class="org-type">LastModified</span>)handler).getLastModified(request) :
            -1L;
    }
}
</pre>
</div>
        </details>

<p>
Controller æŽ¥å£çš„å®šä¹‰ä¹Ÿå¾ˆç®€å•, ä»…ä»…å®šä¹‰äº†ä¸€ä¸ª handleRequest æ–¹æ³•, å…·ä½“æºç å¦‚ä¸‹:
</p>

<details id='orgc40baac' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgc40baac'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">import lines ...</span>

<span class="org-c-annotation">@FunctionalInterface</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">Controller</span> {
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-type">ModelAndView</span> <span class="org-function-name">handleRequest</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                               <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span>;
}
</pre>
</div>
        </details>

<p>
(2) HttpRequestHandlerAdapter
</p>

<p>
HttpRequestHandlerAdapter æœ¬è´¨æ˜¯è°ƒç”¨ HttpRequestHandler çš„ handleRequest æ–¹æ³•, è¯·çœ‹ä¸‹è¿°ä»£ç ç¤ºä¾‹:
</p>

<details id='org3cb502e' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org3cb502e'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">class</span> <span class="org-type">HttpRequestHandlerAdapter</span>
    <span class="org-keyword">implements</span> <span class="org-type">HandlerAdapter</span> {
    <span class="org-keyword">public</span> HttpRequestHandlerAdapter() {
    }

    <span class="org-keyword">public</span> <span class="org-type">boolean</span> <span class="org-function-name">supports</span>(<span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> handler <span class="org-keyword">instanceof</span> HttpRequestHandler;
    }

    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">public</span> <span class="org-type">ModelAndView</span> <span class="org-function-name">handle</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                               <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>,
                               <span class="org-type">Object</span> <span class="org-variable-name">handler</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
        ((<span class="org-type">HttpRequestHandler</span>)handler).handleRequest(request, response);
        <span class="org-keyword">return</span> <span class="org-constant">null</span>;
    }

    <span class="org-keyword">public</span> <span class="org-type">long</span> <span class="org-function-name">getLastModified</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                <span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> handler <span class="org-keyword">instanceof</span> LastModified ?
            ((<span class="org-type">LastModified</span>)handler).getLastModified(request) :
            -1L;
    }
}
</pre>
</div>
        </details>

<p>
HttpRequestHandlerAdapter æœ¬è´¨æ˜¯ HttpRequestH andl er çš„é€‚é…å™¨, æœ€ç»ˆè°ƒç”¨ HttpRequestHandler çš„ handleRequest æ–¹æ³•. æŽ¥å£ HttpRequestHandler çš„å®žçŽ°å¦‚ä¸‹:
</p>

<details id='org5d80f13' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org5d80f13'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-comment-delimiter">// </span><span class="org-comment">import lines ...</span>

<span class="org-c-annotation">@FunctionalInterface</span>
<span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">HttpRequestHandler</span> {
    <span class="org-type">void</span> <span class="org-function-name">handleRequest</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                       <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>)
        <span class="org-keyword">throws</span> <span class="org-type">ServletException</span>, <span class="org-type">IOException</span>;
}
</pre>
</div>
        </details>

<p>
(3) RequestMappingHandlerAdapter
</p>

<p>
RequestMappingHandlerAdapter å…¶çˆ¶ç±»æ˜¯ AbstractHandlerMethodAdapter æŠ½è±¡ç±», AbstractHandlerMethodAdapter åªæ˜¯ç®€å•åœ°å®žçŽ°äº† HandlerAdapter ä¸­å®šä¹‰çš„æŽ¥å£, æœ€ç»ˆè¿˜æ˜¯åœ¨ RequestMappingHandlerAdapter ä¸­å¯¹ä»£ç è¿›è¡Œå®žçŽ°çš„, AbstractHandlerMethodAdapter ä¸­å¢žåŠ äº†æ‰§è¡Œé¡ºåº Order, å…·ä½“å¦‚å›¾æ‰€ç¤º.
</p>


<figure id="orge7d4262">
<img src="/spring/10-4.png" alt="10-4.png">

<figcaption><span class="figure-number">Figure 4: </span>RequestMappingHandlerAdapter ç±»ç»§æ‰¿å…³ç³»</figcaption>
</figure>

<p>
AbstractHandlerMethodAdapter çš„æºç å¦‚ä¸‹:
</p>

<details id='org6c59986' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org6c59986'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">abstract</span> <span class="org-keyword">class</span> <span class="org-type">AbstractHandlerMethodAdapter</span>
    <span class="org-keyword">extends</span> <span class="org-type">WebContentGenerator</span>
    <span class="org-keyword">implements</span> <span class="org-type">HandlerAdapter</span>, <span class="org-type">Ordered</span> {

    <span class="org-comment-delimiter">// </span><span class="org-comment">static variables ...</span>

    <span class="org-keyword">public</span> AbstractHandlerMethodAdapter() {
        <span class="org-keyword">super</span>(<span class="org-constant">false</span>);
    }

    <span class="org-keyword">public</span> <span class="org-type">void</span> <span class="org-function-name">setOrder</span>(<span class="org-type">int</span> <span class="org-variable-name">order</span>) {
        <span class="org-keyword">this</span>.order = order;
    }

    <span class="org-keyword">public</span> <span class="org-type">int</span> <span class="org-function-name">getOrder</span>() {
        <span class="org-keyword">return</span> <span class="org-keyword">this</span>.order;
    }

    <span class="org-keyword">public</span> <span class="org-keyword">final</span> <span class="org-type">boolean</span> <span class="org-function-name">supports</span>(<span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> handler <span class="org-keyword">instanceof</span> HandlerMethod &amp;&amp;
            <span class="org-keyword">this</span>.supportsInternal((<span class="org-type">HandlerMethod</span>)handler);
    }

    <span class="org-keyword">protected</span> <span class="org-keyword">abstract</span> <span class="org-type">boolean</span>
        <span class="org-function-name">supportsInternal</span>(<span class="org-type">HandlerMethod</span> <span class="org-variable-name">handlerMethod</span>);

    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">public</span> <span class="org-keyword">final</span> <span class="org-type">ModelAndView</span> <span class="org-function-name">handle</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                     <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>,
                                     <span class="org-type">Object</span> <span class="org-variable-name">handler</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
        <span class="org-keyword">return</span> <span class="org-keyword">this</span>.handleInternal(request, response, (<span class="org-type">HandlerMethod</span>)handler);
    }

    <span class="org-c-annotation">@Nullable</span>
    <span class="org-keyword">protected</span> <span class="org-keyword">abstract</span> <span class="org-type">ModelAndView</span> <span class="org-function-name">handleInternal</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                                   <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>,
                                                   <span class="org-type">HandlerMethod</span> <span class="org-variable-name">handlerMethod</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span>;

    <span class="org-keyword">public</span> <span class="org-keyword">final</span> <span class="org-type">long</span> <span class="org-function-name">getLastModified</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>, <span class="org-type">Object</span> <span class="org-variable-name">handler</span>) {
        <span class="org-keyword">return</span> <span class="org-keyword">this</span>.getLastModifiedInternal(request, (<span class="org-type">HandlerMethod</span>)handler);
    }

    <span class="org-doc">/** </span><span class="org-doc"><span class="org-doc-markup">@deprecated</span></span><span class="org-doc"> */</span>
    <span class="org-c-annotation">@Deprecated</span>
    <span class="org-keyword">protected</span> <span class="org-keyword">abstract</span> <span class="org-type">long</span> <span class="org-function-name">getLastModifiedInternal</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                                    <span class="org-type">HandlerMethod</span> <span class="org-variable-name">handlerMethod</span>);
}
</pre>
</div>
        </details>

<p>
ä»Žä¸Šè¿°ä»£ç å¯çŸ¥, RequestMappingHandlerAdapter çš„å¤„ç†é€»è¾‘ä¸»è¦ç”± handlelnternal() å®žçŽ°, è€Œæ ¸å¿ƒå¤„ç†é€»è¾‘ç”±æ–¹æ³• invokeHandlerMethod() å®žçŽ°, invokeHandlerMethod æ–¹æ³•å…·ä½“æºç å¦‚ä¸‹:
</p>

<details id='orgce49de0' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgce49de0'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Nullable</span>
<span class="org-keyword">protected</span> <span class="org-type">ModelAndView</span> <span class="org-function-name">invokeHandlerMethod</span>(<span class="org-type">HttpServletRequest</span> <span class="org-variable-name">request</span>,
                                           <span class="org-type">HttpServletResponse</span> <span class="org-variable-name">response</span>,
                                           <span class="org-type">HandlerMethod</span> <span class="org-variable-name">handlerMethod</span>)
    <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
    <span class="org-type">ServletWebRequest</span> <span class="org-variable-name">webRequest</span> =
        <span class="org-keyword">new</span> <span class="org-type">ServletWebRequest</span>(request, response);

    <span class="org-type">Object</span> <span class="org-variable-name">result</span>;
    <span class="org-keyword">try</span> {
        <span class="org-comment-delimiter">// </span><span class="org-comment">binding data</span>
        <span class="org-type">WebDataBinderFactory</span> <span class="org-variable-name">binderFactory</span> =
            <span class="org-keyword">this</span>.getDataBinderFactory(handlerMethod);
        <span class="org-type">ModelFactory</span> <span class="org-variable-name">modelFactory</span> =
            <span class="org-keyword">this</span>.getModelFactory(handlerMethod, binderFactory);
        <span class="org-type">ServletInvocableHandlerMethod</span> <span class="org-variable-name">invocableMethod</span> =
            <span class="org-keyword">this</span>.createInvocableHandlerMethod(handlerMethod);
        <span class="org-keyword">if</span> (<span class="org-keyword">this</span>.argumentResolvers != <span class="org-constant">null</span>) {
            invocableMethod.setHandlerMethodArgumentResolvers(<span class="org-keyword">this</span>.argumentResolvers);
        }

        <span class="org-keyword">if</span> (<span class="org-keyword">this</span>.returnValueHandlers != <span class="org-constant">null</span>) {
            invocableMethod.setHandlerMethodReturnValueHandlers(<span class="org-keyword">this</span>.returnValueHandlers);
        }

        invocableMethod.setDataBinderFactory(binderFactory);
        invocableMethod.setParameterNameDiscoverer(<span class="org-keyword">this</span>.parameterNameDiscoverer);
        <span class="org-comment-delimiter">// </span><span class="org-comment">creating containter of modelAndView</span>
        <span class="org-type">ModelAndViewContainer</span> <span class="org-variable-name">mavContainer</span> =
            <span class="org-keyword">new</span> <span class="org-type">ModelAndViewContainer</span>();
        mavContainer.addAllAttributes(RequestContextUtils.getInputFlashMap(request));
        <span class="org-comment-delimiter">// </span><span class="org-comment">init model</span>
        modelFactory.initModel(webRequest, mavContainer, invocableMethod);
        mavContainer.setIgnoreDefaultModelOnRedirect(<span class="org-keyword">this</span>.ignoreDefaultModelOnRedirect);
        <span class="org-type">AsyncWebRequest</span> <span class="org-variable-name">asyncWebRequest</span> = WebAsyncUtils.createAsyncWebRequest(request, response);
        asyncWebRequest.setTimeout(<span class="org-keyword">this</span>.asyncRequestTimeout);
        <span class="org-type">WebAsyncManager</span> <span class="org-variable-name">asyncManager</span> = WebAsyncUtils.getAsyncManager(request);
        asyncManager.setTaskExecutor(<span class="org-keyword">this</span>.taskExecutor);
        asyncManager.setAsyncWebRequest(asyncWebRequest);
        asyncManager.registerCallableInterceptors(<span class="org-keyword">this</span>.callableInterceptors);
        asyncManager.registerDeferredResultInterceptors(<span class="org-keyword">this</span>.deferredResultInterceptors);
        <span class="org-keyword">if</span> (asyncManager.hasConcurrentResult()) {
            result = asyncManager.getConcurrentResult();
            mavContainer = (<span class="org-type">ModelAndViewContainer</span>)asyncManager.getConcurrentResultContext()[<span class="org-highlight-numbers-number">0</span>];
            asyncManager.clearConcurrentResult();
            LogFormatUtils.traceDebug(<span class="org-keyword">this</span>.logger, (traceOn) -&gt; {
                    <span class="org-type">String</span> <span class="org-variable-name">formatted</span> = LogFormatUtils.formatValue(result, <span class="org-negation-char">!</span>traceOn);
                    <span class="org-keyword">return</span> <span class="org-string">"Resume with async result ["</span> + formatted + <span class="org-string">"]"</span>;
                });
            invocableMethod = invocableMethod.wrapConcurrentResult(result);
        }

        <span class="org-comment-delimiter">// </span><span class="org-comment">invoking handler method</span>
        invocableMethod.invokeAndHandle(webRequest, mavContainer, <span class="org-keyword">new</span> <span class="org-type">Object</span>[<span class="org-highlight-numbers-number">0</span>]);
        <span class="org-keyword">if</span> (<span class="org-negation-char">!</span>asyncManager.isConcurrentHandlingStarted()) {
            <span class="org-type">ModelAndView</span> <span class="org-variable-name">var15</span> =
                <span class="org-keyword">this</span>.getModelAndView(mavContainer, modelFactory, webRequest);
            <span class="org-keyword">return</span> var15;
        }

        result = <span class="org-constant">null</span>;
    } <span class="org-keyword">finally</span> {
        webRequest.requestCompleted();
    }

    <span class="org-keyword">return</span> (<span class="org-type">ModelAndView</span>)result;
}
</pre>
</div>
        </details>

<p>
ä»Žä¸Šè¿°ä»£ç å¯çŸ¥, RequestMappingHandlerAdapter å†…éƒ¨å¯¹äºŽæ¯ä¸ªè¯·æ±‚éƒ½ä¼šå®žä¾‹åŒ–ä¸€ä¸ª ServletlnvocableHandlerMethod(InvocableHandlerMethod çš„å­ç±») è¿›è¡Œå¤„ç†. ServletlnvocableHandlerMethod ç±»ç»§æ‰¿å…³ç³»å¦‚å›¾æ‰€ç¤º.
</p>


<figure id="orgbf1252e">
<img src="/spring/10-5.png" alt="10-5.png">

<figcaption><span class="figure-number">Figure 5: </span>ServletlnvocableHandlerMethod ç±»ç»§æ‰¿å…³ç³»</figcaption>
</figure>

<p>
InvocableHadlerMethod ç±»é€šè¿‡è°ƒç”¨ getMethodArgumentValues() èŽ·å–æ–¹æ³•çš„è¾“å…¥å‚æ•°, å…·ä½“æºç å¦‚ä¸‹:
</p>

<details id='orgce4ba53' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgce4ba53'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">protected</span> <span class="org-type">Object</span>[] <span class="org-function-name">getMethodArgumentValues</span>(<span class="org-type">NativeWebRequest</span> <span class="org-variable-name">request</span>,
                                           <span class="org-c-annotation">@Nullable</span> <span class="org-type">ModelAndViewContainer</span> <span class="org-variable-name">mavContainer</span>,
                                           <span class="org-type">Object</span>... <span class="org-variable-name">providedArgs</span>) <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
    <span class="org-type">MethodParameter</span>[] <span class="org-variable-name">parameters</span> = <span class="org-keyword">this</span>.getMethodParameters();
    <span class="org-keyword">if</span> (ObjectUtils.isEmpty(parameters)) {
        <span class="org-keyword">return</span> EMPTY_ARGS;
    } <span class="org-keyword">else</span> {
        <span class="org-type">Object</span>[] <span class="org-variable-name">args</span> = <span class="org-keyword">new</span> <span class="org-type">Object</span>[parameters.length];

        <span class="org-keyword">for</span>(<span class="org-type">int</span> <span class="org-variable-name">i</span> = <span class="org-highlight-numbers-number">0</span>; i &lt; parameters.<span class="org-type">length</span>; ++i) {
            <span class="org-type">MethodParameter</span> <span class="org-variable-name">parameter</span> = parameters[i];
            parameter.initParameterNameDiscovery(<span class="org-keyword">this</span>.parameterNameDiscoverer);
            args[i] = findProvidedArgument(parameter, providedArgs);
            <span class="org-keyword">if</span> (args[i] == <span class="org-constant">null</span>) {
                <span class="org-keyword">if</span> (<span class="org-negation-char">!</span><span class="org-keyword">this</span>.resolvers.supportsParameter(parameter)) {
                    <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">IllegalStateException</span>(formatArgumentError(parameter,
                                                                        <span class="org-string">"No suitable resolver"</span>));
                }

                <span class="org-keyword">try</span> {
                    args[i] = <span class="org-keyword">this</span>.resolvers.resolveArgument(parameter,
                                                             mavContainer,
                                                             request,
                                                             <span class="org-keyword">this</span>.dataBinderFactory);
                } <span class="org-keyword">catch</span> (<span class="org-type">Exception</span> <span class="org-variable-name">var10</span>) {
                    <span class="org-keyword">if</span> (logger.isDebugEnabled()) {
                        <span class="org-type">String</span> <span class="org-variable-name">exMsg</span> = var10.getMessage();
                        <span class="org-keyword">if</span> (exMsg != <span class="org-constant">null</span> &amp;&amp; <span class="org-negation-char">!</span>exMsg.contains(parameter.getExecutable().toGenericString())) {
                            logger.debug(formatArgumentError(parameter, exMsg));
                        }
                    }

                    <span class="org-keyword">throw</span> var10;
                }
            }
        }

        <span class="org-keyword">return</span> args;
    }
}
</pre>
</div>
        </details>

<p>
ä»Žä¸Šè¿°ä»£ç å¯çŸ¥, è§£æžå‚æ•°çš„æ–¹å¼å’Œ handlerMappings, handlerAdapters ç±»ä¼¼, éƒ½æ˜¯ä»Žä¸€ä¸ª HandlerMethodArgumentResolver åˆ—è¡¨ä¸­éåŽ†, æ‰¾åˆ°ä¸€ä¸ªèƒ½å¤Ÿå¤„ç†çš„ bean, ç„¶åŽè°ƒç”¨ bean çš„æ ¸å¿ƒæ–¹æ³•å¤„ç†. HandlerMethodArgumentResolver æŽ¥å£çš„å®šä¹‰å¦‚ä¸‹æ‰€ç¤º:
</p>

<details id='org364de49' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org364de49'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">HandlerMethodArgumentResolver</span> {
    <span class="org-type">boolean</span> <span class="org-function-name">supportsParameter</span>(<span class="org-type">MethodParameter</span> <span class="org-variable-name">parameter</span>);

    <span class="org-c-annotation">@Nullable</span>
    <span class="org-type">Object</span> <span class="org-function-name">resolveArgument</span>(<span class="org-type">MethodParameter</span> <span class="org-variable-name">parameter</span>,
                           <span class="org-c-annotation">@Nullable</span> <span class="org-type">ModelAndViewContainer</span> <span class="org-variable-name">mavContainer</span>,
                           <span class="org-type">NativeWebRequest</span> <span class="org-variable-name">webRequest</span>,
                           <span class="org-c-annotation">@Nullable</span> <span class="org-type">WebDataBinderFactory</span> <span class="org-variable-name">binderFactory</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span>;
}
</pre>
</div>
        </details>

<p>
HandlerMethodArgumentResolver ç±»é€šè¿‡ supportsParameter ç­›é€‰ç¬¦åˆæ¡ä»¶çš„ resolver, ç„¶åŽè°ƒç”¨ resolver çš„ resolveArgument è§£æžå‰ç«¯å‚æ•°. Spring æä¾›è®¸å¤š HandlerMethodArgumentResolver, å…·ä½“å¯ä»¥åœ¨ RequestMappingHandlerAdapter.afterPropertiesSetQ æ–¹æ³•ä¸­æŸ¥çœ‹.
</p>

<details id='orgccd6251' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgccd6251'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">private</span> <span class="org-type">List</span>&lt;<span class="org-type">HandlerMethodArgumentResolver</span>&gt; <span class="org-function-name">getDefaultArgumentResolvers</span>() {
    <span class="org-type">List</span>&lt;<span class="org-type">HandlerMethodArgumentResolver</span>&gt; <span class="org-variable-name">resolvers</span> = <span class="org-keyword">new</span> <span class="org-type">ArrayList</span>(<span class="org-highlight-numbers-number">30</span>);
    <span class="org-comment-delimiter">// </span><span class="org-comment">annotation-based argument resolution</span>
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestParamMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getBeanFactory(), <span class="org-constant">false</span>));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestParamMapMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">PathVariableMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">PathVariableMapMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">MatrixVariableMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">MatrixVariableMapMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ServletModelAttributeMethodProcessor</span>(<span class="org-constant">false</span>));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestResponseBodyMethodProcessor</span>(
                                                         <span class="org-keyword">this</span>.getMessageConverters(),
                                                         <span class="org-keyword">this</span>.requestResponseBodyAdvice));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestPartMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getMessageConverters(),
                                                        <span class="org-keyword">this</span>.requestResponseBodyAdvice));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestHeaderMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getBeanFactory()));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestHeaderMapMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ServletCookieValueMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getBeanFactory()));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ExpressionValueMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getBeanFactory()));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">SessionAttributeMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestAttributeMethodArgumentResolver</span>());
    <span class="org-comment-delimiter">// </span><span class="org-comment">type-based argument resolution</span>
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ServletRequestMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ServletResponseMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">HttpEntityMethodProcessor</span>(<span class="org-keyword">this</span>.getMessageConverters(),
                                                <span class="org-keyword">this</span>.requestResponseBodyAdvice));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RedirectAttributesMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ModelMethodProcessor</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">MapMethodProcessor</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ErrorsMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">SessionStatusMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">UriComponentsBuilderMethodArgumentResolver</span>());
    <span class="org-keyword">if</span> (KotlinDetector.isKotlinPresent()) {
        resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ContinuationHandlerMethodArgumentResolver</span>());
    }

    <span class="org-comment-delimiter">// </span><span class="org-comment">custom arguments</span>
    <span class="org-keyword">if</span> (<span class="org-keyword">this</span>.getCustomArgumentResolvers() != <span class="org-constant">null</span>) {
        resolvers.addAll(<span class="org-keyword">this</span>.getCustomArgumentResolvers());
    }

    <span class="org-comment-delimiter">// </span><span class="org-comment">default all</span>
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">PrincipalMethodArgumentResolver</span>());
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">RequestParamMethodArgumentResolver</span>(<span class="org-keyword">this</span>.getBeanFactory(), <span class="org-constant">true</span>));
    resolvers.add(<span class="org-keyword">new</span> <span class="org-type">ServletModelAttributeMethodProcessor</span>(<span class="org-constant">true</span>));
    <span class="org-keyword">return</span> resolvers;
}
</pre>
</div>
        </details>

<p>
ä»Žä¸Šè¿°ä»£ç å¯çŸ¥, é™¤äº† Spring æä¾›çš„ RequestParamMethodArgumentResolver
</p>

<p>
PathVariableMethodArgumentResolver&gt; SessionAttributeMethodArgumentResolver ç­‰é»˜è®¤ resolver ä¹‹å¤–, è¿˜å¯ä»¥è‡ªå®šä¹‰ resolver, é€šè¿‡æ³¨è§£æ¥æŒ‡å®šå¤„ç†çš„å‚æ•°ç±»åž‹, ç„¶åŽé€šè¿‡ getCustomArgumentResolvers æ–¹æ³•ä¼šæ³¨å†Œåˆ° revolver åˆ—è¡¨. ä¸‹é¢ä»¥ RequestParamMethodArgumentResolver ä¸ºä¾‹åšç®€å•çš„åˆ†æž, å…·ä½“ç±»ç»§æ‰¿å…³ç³»å¦‚å›¾æ‰€ç¤º.
</p>


<figure id="orge432f2e">
<img src="/spring/10-6.png" alt="10-6.png">

<figcaption><span class="figure-number">Figure 6: </span>ServletlnvocableHandlerMethod ç±»ç»§æ‰¿å…³ç³»</figcaption>
</figure>

<p>
RequestParamMethodArgumentResolver çˆ¶ç±»æ˜¯ AbstractNamedValueMethodArgumentResolver, å…¶ä¸­æœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯ resolveArgument:
</p>

<details id='org22b0321' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org22b0321'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@Nullable</span>
<span class="org-keyword">public</span> <span class="org-keyword">final</span> <span class="org-type">Object</span> <span class="org-function-name">resolveArgument</span>(<span class="org-type">MethodParameter</span> <span class="org-variable-name">parameter</span>,
                                    <span class="org-c-annotation">@Nullable</span> <span class="org-type">ModelAndViewContainer</span> <span class="org-variable-name">mavContainer</span>,
                                    <span class="org-type">NativeWebRequest</span> <span class="org-variable-name">webRequest</span>,
                                    <span class="org-c-annotation">@Nullable</span> <span class="org-type">WebDataBinderFactory</span> <span class="org-variable-name">binderFactory</span>)
    <span class="org-keyword">throws</span> <span class="org-type">Exception</span> {
    <span class="org-type">NamedValueInfo</span> <span class="org-variable-name">namedValueInfo</span> =
        <span class="org-keyword">this</span>.getNamedValueInfo(parameter);
    <span class="org-type">MethodParameter</span> <span class="org-variable-name">nestedParameter</span> =
        parameter.nestedIfOptional();
    <span class="org-type">Object</span> <span class="org-variable-name">resolvedName</span> = <span class="org-keyword">this</span>.resolveEmbeddedValuesAndExpressions(namedValueInfo.name);
    <span class="org-keyword">if</span> (resolvedName == <span class="org-constant">null</span>) {
        <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">IllegalArgumentException</span>(<span class="org-string">"Specified name must not resolve to null: ["</span> +
                                           namedValueInfo.name + <span class="org-string">"]"</span>);
    } <span class="org-keyword">else</span> {
        <span class="org-type">Object</span> <span class="org-variable-name">arg</span> = <span class="org-keyword">this</span>.resolveName(resolvedName.toString(),
                                      nestedParameter, webRequest);
        <span class="org-keyword">if</span> (arg == <span class="org-constant">null</span>) {
            <span class="org-keyword">if</span> (namedValueInfo.defaultValue != <span class="org-constant">null</span>) {
                arg =
                    <span class="org-keyword">this</span>.resolveEmbeddedValuesAndExpressions(namedValueInfo.defaultValue);
            } <span class="org-keyword">else</span> <span class="org-keyword">if</span> (namedValueInfo.required &amp;&amp; <span class="org-negation-char">!</span>nestedParameter.isOptional()) {
                <span class="org-keyword">this</span>.handleMissingValue(namedValueInfo.name, nestedParameter, webRequest);
            }

            arg = <span class="org-keyword">this</span>.handleNullValue(namedValueInfo.name, arg,
                                       nestedParameter.getNestedParameterType());
        } <span class="org-keyword">else</span> <span class="org-keyword">if</span> (<span class="org-string">""</span>.equals(arg) &amp;&amp; namedValueInfo.defaultValue != <span class="org-constant">null</span>) {
            arg = <span class="org-keyword">this</span>.resolveEmbeddedValuesAndExpressions(namedValueInfo.defaultValue);
        }

        <span class="org-keyword">if</span> (binderFactory != <span class="org-constant">null</span>) {
            <span class="org-type">WebDataBinder</span> <span class="org-variable-name">binder</span> = binderFactory.createBinder(webRequest,
                                                              (Object)<span class="org-constant">null</span>, namedValueInfo.name);

            <span class="org-keyword">try</span> {
                arg = binder.convertIfNecessary(arg, parameter.getParameterType(), parameter);
            } <span class="org-keyword">catch</span> (<span class="org-type">ConversionNotSupportedException</span> <span class="org-variable-name">var11</span>) {
                <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">MethodArgumentConversionNotSupportedException</span>(arg,
                                                                        var11.getRequiredType(),
                                                                        namedValueInfo.name,
                                                                        parameter,
                                                                        var11.getCause());
            } <span class="org-keyword">catch</span> (<span class="org-type">TypeMismatchException</span> <span class="org-variable-name">var12</span>) {
                <span class="org-keyword">throw</span> <span class="org-keyword">new</span> <span class="org-type">MethodArgumentTypeMismatchException</span>(arg, var12.getRequiredType(),
                                                              namedValueInfo.name,
                                                              parameter,
                                                              var12.getCause());
            }

            <span class="org-keyword">if</span> (arg == <span class="org-constant">null</span> &amp;&amp; namedValueInfo.defaultValue == <span class="org-constant">null</span> &amp;&amp;
                namedValueInfo.required &amp;&amp;
                <span class="org-negation-char">!</span>nestedParameter.isOptional()) {
                <span class="org-keyword">this</span>.handleMissingValueAfterConversion(namedValueInfo.name,
                                                       nestedParameter,
                                                       webRequest);
            }
        }

        <span class="org-keyword">this</span>.handleResolvedValue(arg,
                                 namedValueInfo.name,
                                 parameter,
                                 mavContainer,
                                 webRequest);
        <span class="org-keyword">return</span> arg;
    }
}
</pre>
</div>
        </details>

<p>
ç”±ä¸Šè¿°ä»£ç å¯çŸ¥, Spring MVC æ¡†æž¶å°† ServletRequest å¯¹è±¡åŠå¤„ç†æ–¹æ³•çš„å‚æ•°å¯¹è±¡å®žä¾‹ä¼ é€’ç»™ DataBinder, DataBinder ä¼šè°ƒç”¨è£…é…åœ¨ Spring MVC ä¸Šä¸‹æ–‡çš„ ConversionService ç»„ä»¶è¿›è¡Œæ•°æ®ç±»åž‹è½¬æ¢, æ•°æ®æ ¼å¼è½¬æ¢å·¥ä½œ, å¹¶å°† ServletRequest ä¸­çš„æ¶ˆæ¯å¡«å……åˆ°å‚æ•°å¯¹è±¡ä¸­. ç„¶åŽå†è°ƒç”¨ Validator ç»„ä»¶å¯¹ç»‘å®šäº†è¯·æ±‚æ¶ˆæ¯æ•°æ®çš„å‚æ•°å¯¹è±¡è¿›è¡Œæ•°æ®åˆæ³•æ€§æ ¡éªŒ, å¹¶æœ€ç»ˆç”Ÿæˆæ•°æ®ç»‘å®šç»“æžœ BindingResult å¯¹è±¡. BindingResuIt åŒ…å«å·²å®Œæˆæ•°æ®ç»‘å®šçš„å‚æ•°å¯¹è±¡, è¿˜åŒ…å«ç›¸åº”çš„æ£€éªŒé”™è¯¯å¯¹è±¡.
</p>
</div>
</div>
</div>

<div id="outline-container-org749aabd" class="outline-2">
<h2 id="org749aabd"><span class="section-number-2">3.</span> ViewResoIver</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-orga8d10e2" class="outline-3">
<h3 id="orga8d10e2"><span class="section-number-3">3.1.</span> ViewResolver Overview</h3>
<div class="outline-text-3" id="text-3-1">
<p>
ViewResoIver æ˜¯ Spring MVC å¤„ç†æµç¨‹ä¸­çš„æœ€åŽä¸€ä¸ªçŽ¯èŠ‚, Spring MVC æµç¨‹æœ€åŽè¿”å›žç»™ç”¨æˆ·çš„è§†å›¾ä¸ºå…·ä½“çš„ View å¯¹è±¡, View å¯¹è±¡åŒ…å« Model å¯¹è±¡, è€Œ Model å¯¹è±¡å­˜æ”¾åŽç«¯éœ€è¦åé¦ˆç»™å‰ç«¯çš„æ•°æ®. è§†å›¾è§£æžå™¨æŠŠä¸€ä¸ªé€»è¾‘ä¸Šçš„è§†å›¾åç§°è§£æžä¸ºä¸€ä¸ªå…·ä½“çš„ View è§†å›¾å¯¹è±¡, æœ€ç»ˆçš„è§†å›¾å¯ä»¥æ˜¯ JSP, Excek JFreeChart ç­‰.
</p>
</div>
</div>

<div id="outline-container-org9c17a53" class="outline-3">
<h3 id="org9c17a53"><span class="section-number-3">3.2.</span> Resolution Process</h3>
<div class="outline-text-3" id="text-3-2">
<p>
SpringMVC çš„è§†å›¾è§£æžæµç¨‹ä¸º:
</p>

<p>
(1) SpringMVC è°ƒç”¨ç›®æ ‡æ–¹æ³•, å°†ç›®æ ‡æ–¹æ³•è¿”å›žçš„ String, View, ModelMap æˆ– ModelAndView éƒ½è½¬æ¢ä¸ºä¸€ä¸ª Model And View å¯¹è±¡.
</p>

<p>
(2) é€šè¿‡è§†å›¾è§£æžå™¨ ViewResoIver å°† ModelAndView å¯¹è±¡ä¸­çš„ View å¯¹è±¡è¿›è¡Œè§£æž, å°†é€»è¾‘è§†å›¾ View å¯¹è±¡è§£æžä¸ºä¸€ä¸ªç‰©ç†è§†å›¾ View å¯¹è±¡.
</p>

<p>
(3) è°ƒç”¨ç‰©ç†è§†å›¾ View å¯¹è±¡çš„ render() æ–¹æ³•è¿›è¡Œè§†å›¾æ¸²æŸ“, å¾—åˆ°å“åº”ç»“æžœ.
</p>
</div>
</div>

<div id="outline-container-orgd10b486" class="outline-3">
<h3 id="orgd10b486"><span class="section-number-3">3.3.</span> Usual ViewResolver</h3>
<div class="outline-text-3" id="text-3-3">
<p>
SpringMVC æä¾›å¾ˆå¤šè§†å›¾è§£æžå™¨ç±», å…·ä½“å¦‚å›¾æ‰€ç¤º.
</p>


<figure id="org7f07608">
<img src="/spring/10-7.png" alt="10-7.png">

<figcaption><span class="figure-number">Figure 7: </span>ViewResoIver ç±»ç»§æ‰¿å…³ç³»</figcaption>
</figure>

<p>
ä¸‹é¢ä»‹ç»ä¸€äº›å¸¸ç”¨çš„è§†å›¾è§£æžå™¨ç±». é™¤äº†ä¸Šå›¾æ‰€ç¤ºçš„ resolver ä¹‹å¤–, è¿˜æœ‰ GroovyMarkupViewResolver, TilesViewResolver, ä¸è¿‡é‚£äº›æš‚æ—¶ä¸è€ƒè™‘, æ‰€ä»¥å…ˆè¡Œçœç•¥äº†.
</p>

<p>
(1) ViewResolver
</p>

<p>
ViewResolver æ˜¯æ‰€æœ‰è§†å›¾è§£æžå™¨çš„çˆ¶ç±», å…·ä½“æºç å¦‚ä¸‹:
</p>

<details id='orgeab7ff2' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#orgeab7ff2'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-keyword">public</span> <span class="org-keyword">interface</span> <span class="org-type">ViewResolver</span> {
    <span class="org-c-annotation">@Nullable</span>
    <span class="org-type">View</span> <span class="org-function-name">resolveViewName</span>(<span class="org-type">String</span> <span class="org-variable-name">viewName</span>,
                         <span class="org-type">Locale</span> <span class="org-variable-name">locale</span>)
        <span class="org-keyword">throws</span> <span class="org-type">Exception</span>;
}
</pre>
</div>
        </details>

<p>
ViewResolver çš„ä¸»è¦ä½œç”¨æ˜¯æŠŠä¸€ä¸ªé€»è¾‘ä¸Šçš„è§†å›¾åç§°è§£æžä¸ºä¸€ä¸ªçœŸæ­£çš„è§†å›¾, ç„¶åŽé€šè¿‡ View å¯¹è±¡è¿›è¡Œæ¸²æŸ“.
</p>

<p>
(2) AbstractCachingViewResolver
</p>

<p>
æŠ½è±¡ç±», è¿™ç§è§†å›¾è§£æžå™¨ä¼šæŠŠè§£æžè¿‡çš„è§†å›¾ä¿å­˜èµ·æ¥, ç„¶åŽåœ¨æ¯æ¬¡è§£æžè§†å›¾æ—¶å…ˆä»Žç¼“å­˜é‡Œé¢æŸ¥æ‰¾, å¦‚æžœæ‰¾åˆ°äº†å¯¹åº”çš„è§†å›¾å°±ç›´æŽ¥è¿”å›ž, å¦‚æžœæ²¡æœ‰æ‰¾åˆ°å°±åˆ›å»ºä¸€ä¸ªæ–°çš„è§†å›¾å¯¹è±¡, ç„¶åŽæŠŠå®ƒå­˜æ”¾åˆ°ç”¨äºŽç¼“å­˜çš„ Map ä¸­, æŽ¥ç€å†æŠŠæ–°å»ºçš„è§†å›¾è¿”å›ž. ä½¿ç”¨è¿™ç§è§†å›¾ç¼“å­˜çš„æ–¹å¼å¯ä»¥æŠŠè§£æžè§†å›¾çš„æ€§èƒ½é—®é¢˜é™åˆ°æœ€ä½Ž.
</p>

<p>
(3) UrlBasedViewResolver
</p>

<p>
è¯¥ç±»ç»§æ‰¿äº† AbstractCachingViewResolver, ä¸»è¦æ˜¯æä¾›ä¸€ç§æ‹¼æŽ¥ URL çš„æ–¹å¼æ¥è§£æžè§†å›¾, å®ƒå¯ä»¥é€šè¿‡ prefix å±žæ€§æŒ‡å®šçš„å‰ç¼€, é€šè¿‡ suffix å±žæ€§æŒ‡å®šåŽç¼€, ç„¶åŽæŠŠè¿”å›žçš„é€»è¾‘è§†å›¾åç§°åŠ ä¸ŠæŒ‡å®šçš„å‰ç¼€å’ŒåŽç¼€å°±æ˜¯æŒ‡å®šçš„è§†å›¾ URL äº†. å¦‚ prefix=/WEB-INF/jsps/, suffix=.jsp, è¿”å›žçš„è§†å›¾åç§° viewName=test/indx, è´ U UrlBasedViewResolver è§£æžå‡ºæ¥çš„è§†å›¾ URL å°±æ˜¯ AVEB-INF/jsps/test/index.jsp, é»˜è®¤çš„ prefix å’Œ suffix éƒ½æ˜¯ç©ºä¸².
</p>

<p>
URLBasedViewResolver æ”¯æŒè¿”å›žçš„è§†å›¾åç§°ä¸­åŒ…å« redirect: å‰ç¼€, è¿™æ ·å°±å¯ä»¥æ”¯æŒ URL åœ¨å®¢æˆ·ç«¯çš„è·³è½¬, å¦‚å½“è¿”å›žçš„è§†å›¾åç§°æ˜¯ &ldquo;redirect: test.do&rdquo; çš„æ—¶å€™, URLBasedViewResolver å‘çŽ°è¿”å›žçš„è§†å›¾åç§°åŒ…å«&ldquo;redirect: &rdquo; å‰ç¼€, äºŽæ˜¯æŠŠè¿”å›žçš„è§†å›¾åç§°å‰ç¼€&ldquo;redirect: â€œåŽ»æŽ‰, å–åŽé¢çš„ test.do ç»„æˆä¸€ä¸ª Redirect View, Redirect View ä¸­å°†æŠŠè¯·æ±‚è¿”å›žçš„æ¨¡åž‹å±žæ€§ç»„åˆæˆæŸ¥è¯¢å‚æ•°çš„å½¢å¼ç»„åˆåˆ° redirect çš„ URL åŽé¢, ç„¶åŽè°ƒç”¨ HttpServletResponse å¯¹è±¡çš„ sendRedirect æ–¹æ³•è¿›è¡Œé‡å®šå‘. åŒæ · URLBasedViewResolver è¿˜æ”¯æŒ forword: å‰ç¼€, å¯¹äºŽè§†å›¾åç§°ä¸­åŒ…å« forword: å‰ç¼€çš„è§†å›¾åç§°å°†ä¼šè¢«å°è£…æˆä¸€ä¸ª InternalResourceView å¯¹è±¡, ç„¶åŽåœ¨æœåŠ¡å™¨ç«¯åˆ©ç”¨ RequestDispatcher çš„ forword æ–¹å¼è·³è½¬åˆ°æŒ‡å®šçš„åœ°å€. ä½¿ç”¨ UrlBasedViewResolver çš„æ—¶å€™å¿…é¡»æŒ‡å®šå±žæ€§ viewClass, è¡¨ç¤ºè§£æžæˆå“ªç§è§†å›¾, ä¸€èˆ¬ä½¿ç”¨è¾ƒå¤šçš„å°±æ˜¯ InternalResourceView, åˆ©ç”¨å®ƒæ¥å±•çŽ° JSP, ä½†æ˜¯å½“ä½¿ç”¨ JSTL çš„æ—¶å€™å¿…é¡»ä½¿ç”¨ JstlViewo å…·ä½“å®žä¾‹å¦‚ä¸‹æ‰€ç¤º:
</p>

<details id='org056dc37' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org056dc37'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span>
    <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.UrlBasedViewResolver"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"prefix"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/WEB-INF/"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"suffix"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">".jsp"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"viewClass"</span>
            <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"org.springframework.web.servlet.view.InternalResourceView"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
ä¸Šè¿°ä»£ç ä¸­, å½“è¿”å›žçš„é€»è¾‘è§†å›¾åç§°ä¸º test æ—¶, UrlBasedViewResolver å°†é€»è¾‘è§†å›¾åç§°åŠ ä¸Šå®šä¹‰å¥½çš„å‰ç¼€å’ŒåŽç¼€, å³ &ldquo;/WEB.INF/test.jsp&rdquo;, ç„¶åŽæ–°å»ºä¸€ä¸ª viewClass å±žæ€§æŒ‡å®šçš„è§†å›¾ç±»åž‹äºˆä»¥è¿”å›ž, å³è¿”å›žä¸€ä¸ª URL ä¸º&ldquo;/WEB-INF/test.jsp&rdquo; çš„ InternalResourceView å¯¹è±¡.
</p>

<p>
(4) InternalResourceViewResolver
</p>

<p>
è¯¥ç±»æ˜¯ URLBasedViewResolver çš„å­ç±», æ‰€ä»¥ URLBasedViewResolver æ”¯æŒçš„ç‰¹æ€§å®ƒéƒ½æ”¯æŒ. InternalResourceViewResolver æ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ä¸ªè§†å›¾è§£æžå™¨. å¯ä»¥æŠŠ InternalResourceViewResolver è§£é‡Šä¸ºå†…éƒ¨èµ„æºè§†å›¾è§£æžå™¨, InternalResourceViewResolver ä¼šæŠŠè¿”å›žçš„è§†å›¾åç§°éƒ½è§£æžä¸º InternalResourceView å¯¹è±¡, InternalResourceView ä¼šæŠŠ Controller å¤„ç†å™¨æ–¹æ³•è¿”å›žçš„æ¨¡åž‹å±žæ€§éƒ½å­˜æ”¾åˆ°å¯¹åº”çš„ request å±žæ€§ä¸­, ç„¶åŽé€šè¿‡ RequestDispatcher åœ¨æœåŠ¡å™¨ç«¯æŠŠè¯·æ±‚ forword é‡å®šå‘åˆ°ç›®æ ‡ URL. æ¯”å¦‚åœ¨ InternalResourceViewResolver ä¸­å®šä¹‰äº† prefix=AVEB-INF/, suffix=.jsp, ç„¶åŽè¯·æ±‚çš„ Controller å¤„ç†å™¨æ–¹æ³•è¿”å›žçš„è§†å›¾åç§°ä¸º test, é‚£ä¹ˆè¿™ä¸ªæ—¶å€™ InternalResourceViewResolver å°±ä¼šæŠŠ test è§£æžä¸ºä¸€ä¸ª InternalResourceView å¯¹è±¡, å…ˆæŠŠè¿”å›žçš„æ¨¡åž‹å±žæ€§éƒ½å­˜æ”¾åˆ°å¯¹åº”çš„ HttpServletRequest å±žæ€§ä¸­, ç„¶åŽåˆ©ç”¨ RequestDispatcher åœ¨æœåŠ¡å™¨ç«¯æŠŠè¯·æ±‚ forword åˆ° /WEB-INF/test.jsp. è¿™å°±æ˜¯ InternalResourceViewResolver ä¸€ä¸ªéžå¸¸é‡è¦çš„ç‰¹æ€§.
</p>

<p>
å­˜æ”¾åœ¨ <code>/WEB-INF/</code> ä¸‹é¢çš„å†…å®¹æ˜¯ä¸èƒ½ç›´æŽ¥é€šè¿‡ request è¯·æ±‚çš„æ–¹å¼è¯·æ±‚åˆ°çš„, ä¸ºäº†å®‰å…¨æ€§è€ƒè™‘, é€šå¸¸ä¼šæŠŠ JSP æ–‡ä»¶æ”¾åœ¨ WEB-INF ç›®å½•ä¸‹, è€Œ InternalResourceView åœ¨æœåŠ¡å™¨ç«¯è·³è½¬çš„æ–¹å¼å¯ä»¥å¾ˆå¥½åœ°è§£å†³è¿™ä¸ªé—®é¢˜.
</p>

<p>
ä¸Šè¿°ä»£ç æ˜¯ä¸€ä¸ª InternalResourceViewResolver çš„å®šä¹‰, æ ¹æ®è¯¥å®šä¹‰å½“è¿”å›žçš„é€»è¾‘è§†å›¾åç§°æ˜¯ test çš„æ—¶å€™, InternalResourceViewResolver ä¼šç»™å®ƒåŠ ä¸Šå®šä¹‰å¥½çš„å‰ç¼€å’ŒåŽç¼€, ç»„æˆ &ldquo;/WEB-INF/test.jsp&rdquo; çš„å½¢å¼, ç„¶åŽæŠŠå®ƒå½“åšä¸€ä¸ª InternalResourceView çš„ URL æ–°å»ºä¸€ä¸ª InternalResourceView å¯¹è±¡è¿”å›ž.
</p>

<p>
(5) XmlViewResolver
</p>

<p>
åœ¨å®žéªŒçš„çŽ¯å¢ƒ (5.3.22) ä¸­è¿™ä¸ªè§£æžå™¨å·²ç»è¢«æ ‡äº† deprecated. ä½†è¿˜æ˜¯è¯´ä¸€äº›è€çš„å§.
</p>

<p>
å®ƒç»§æ‰¿è‡ª AbstractCachingViewResolver æŠ½è±¡ç±», æ‰€ä»¥å®ƒä¹Ÿæ˜¯æ”¯æŒè§†å›¾ç¼“å­˜çš„. XmlViewResolver éœ€è¦ç»™å®šä¸€ä¸ª XML é…ç½®æ–‡ä»¶, è¯¥æ–‡ä»¶å°†ä½¿ç”¨å’Œ Spring çš„ bean å·¥åŽ‚é…ç½®æ–‡ä»¶ä¸€æ ·çš„ DTD å®šä¹‰, æ‰€ä»¥å…¶å®žè¯¥æ–‡ä»¶å°±æ˜¯ç”¨æ¥å®šä¹‰è§†å›¾çš„ bean å¯¹è±¡çš„. åœ¨è¯¥æ–‡ä»¶ä¸­å®šä¹‰çš„æ¯ä¸€ä¸ªè§†å›¾çš„ bean å¯¹è±¡éƒ½ç»™å®šä¸€ä¸ªåå­—, ç„¶åŽ XmlViewResolver å°†æ ¹æ® Controller å¤„ç†å™¨æ–¹æ³•è¿”å›žçš„é€»è¾‘è§†å›¾åç§°åˆ° XmlViewResolver æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä¸­å¯»æ‰¾å¯¹åº”åç§°çš„è§†å›¾ bean ç”¨äºŽå¤„ç†è§†å›¾. è¯¥é…ç½®æ–‡ä»¶é»˜è®¤æ˜¯ /WEB-INF/views.xml æ–‡ä»¶, å¦‚æžœä¸ä½¿ç”¨é»˜è®¤å€¼çš„æ—¶å€™å¯ä»¥åœ¨ XmlViewResolver çš„ location å±žæ€§ä¸­æŒ‡å®šå®ƒçš„ä½ç½®. XmlViewResolver è¿˜å®žçŽ°äº† Ordered æŽ¥å£, å› æ­¤å¯ä»¥é€šè¿‡å…¶ order å±žæ€§æ¥æŒ‡å®šåœ¨ ViewResolver é“¾ä¸­å®ƒæ‰€å¤„çš„ä½ç½®, order çš„å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜. ä»¥ä¸‹æ˜¯ä½¿ç”¨ XmlViewResolver çš„ä¸€ä¸ªç¤ºä¾‹:
</p>

<details id='org7b7c9cc' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org7b7c9cc'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.XmlViewResolver"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"location"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/WEB-INF/views.xml"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"order"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"1"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ XmlViewResolver çš„ bean å®šä¹‰. ä½¿ç”¨ location å±žæ€§æŒ‡å®šå…¶é…ç½®æ–‡ä»¶æ‰€åœ¨çš„ä½ç½®, order å±žæ€§æŒ‡å®šå½“æœ‰å¤šä¸ª ViewResolver çš„æ—¶å€™å…¶å¤„ç†è§†å›¾çš„ä¼˜å…ˆçº§.
</p>

<p>
åœ¨ XmlViewResolver å¯¹åº”çš„é…ç½®æ–‡ä»¶ä¸­é…ç½®å¥½æ‰€éœ€è¦çš„è§†å›¾å®šä¹‰, è§†å›¾é…ç½®æ–‡ä»¶ views.xml å…·ä½“çš„é…ç½®å¦‚ä¸‹æ‰€ç¤º:
</p>

<details id='orgf8c171f' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#orgf8c171f'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="UTF-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">beans</span> <span class="org-nxml-namespace-attribute-xmlns">xmlns</span>=<span class="org-string">"http://www.springframework.org/schema/beans"</span>
       <span class="org-nxml-namespace-attribute-xmlns">xmlns</span><span class="org-nxml-namespace-attribute-colon">:</span><span class="org-nxml-namespace-attribute-prefix">xsi</span>=<span class="org-string">"http://www.w3.org/2001/XMLSchema-instance"</span>
       <span class="org-nxml-attribute-prefix">xsi</span><span class="org-nxml-attribute-colon">:</span><span class="org-nxml-attribute-local-name">schemaLocation</span>=<span class="org-string">"http://www.springframework.org/schema/beans</span>
<span class="org-string">                           http://www.springframework.org/schema/beansspring-beans-3.0.xsd"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"index"</span>
        <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.InternalResourceView"</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/index.jsp"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">beans</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
æœ€åŽ, å®šä¹‰ä¸€ä¸ªè¿”å›žçš„é€»è¾‘è§†å›¾åç§°ä¸ºåœ¨ XmlViewResolver é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„è§†å›¾åç§° index:
</p>

<details id='org07f4fed' class='code' open><summary><span class="lang">Java</span></summary>
        <div class='gutter'>
        <a href='#org07f4fed'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-java"><span class="org-c-annotation">@RequestMapping</span>(<span class="org-string">"/index"</span>)
<span class="org-keyword">public</span> <span class="org-type">String</span> <span class="org-function-name">index</span>() {
    <span class="org-keyword">return</span> <span class="org-string">"index"</span>;
}
</pre>
</div>
        </details>

<p>
å½“è®¿é—®ä¸Šé¢å®šä¹‰å¥½çš„ index æ–¹æ³•çš„æ—¶å€™è¿”å›žçš„é€»è¾‘è§†å›¾åç§°ä¸º &ldquo;index&rdquo;, è¿™æ—¶å€™ Spring MVC ä¼šä»Ž views.xml é…ç½®æ–‡ä»¶ä¸­å¯»æ‰¾ id æˆ–è€… name ä¸º &ldquo;index&rdquo; çš„ bean å¯¹è±¡äºˆä»¥è¿”å›ž, è¿™é‡Œ Spring æ‰¾åˆ°çš„æ˜¯ä¸€ä¸ª URL ä¸º &ldquo;/index.jsp&rdquo; çš„ InternalResourceView å¯¹è±¡, ç„¶åŽè¿›è¡Œè§†å›¾è§£æž, å°†æœ€ç»ˆçš„è§†å›¾é¡µé¢æ˜¾ç¤ºç»™ç”¨æˆ·.
</p>

<p>
(6) BeanNameViewResolver
</p>

<p>
è¿™ä¸ªè§†å›¾è§£æžå™¨è·Ÿ XmlViewResolver æœ‰ç‚¹ç±»ä¼¼, ä¹Ÿæ˜¯é€šè¿‡æŠŠè¿”å›žçš„é€»è¾‘è§†å›¾åç§°åŒ¹é…å®šä¹‰å¥½çš„è§†å›¾ bean å¯¹è±¡. ä¸»è¦çš„åŒºåˆ«æœ‰ä¸¤ç‚¹:
</p>

<ol class="org-ol">
<li>BeanNameViewResolver è¦æ±‚è§†å›¾ bean å¯¹è±¡éƒ½å®šä¹‰åœ¨ Spring çš„ application context ä¸­, è€Œ XmlViewResolver æ˜¯åœ¨æŒ‡å®šçš„é…ç½®æ–‡ä»¶ä¸­å¯»æ‰¾è§†å›¾ bean å¯¹è±¡.</li>

<li>BeanNameViewResolver ä¸ä¼šè¿›è¡Œè§†å›¾ç¼“å­˜.</li>
</ol>

<p>
ä¸‹é¢æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„å®žä¾‹:
</p>

<details id='org25bc35a' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org25bc35a'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.BeanNameViewResolver"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"order"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"1"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"test"</span>
      <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.InternalResourceView"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/index.jsp"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
ä¸Šè¿°ä»£ç ä¸­, åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ä¸ª BeanNameViewResolver è§†å›¾è§£æžå™¨å’Œä¸€ä¸ª id ä¸º test çš„ InternalResourceView bean å¯¹è±¡. è¿™æ ·å½“è¿”å›žçš„é€»è¾‘è§†å›¾åç§°ä¸º test æ—¶, å°±ä¼šè§£æžä¸ºä¸Šé¢å®šä¹‰å¥½çš„ id ä¸º test çš„ InternalResourceView å¯¹è±¡, ç„¶åŽè·³è½¬åˆ° index.jsp é¡µé¢.
</p>

<p>
(7) ResourceBundleViewResolver
</p>

<p>
è¯¥ç±»ä¹Ÿæ˜¯ç»§æ‰¿è‡ª AbstractCaching ViewResolver ç±», ä½†æ˜¯å®ƒç¼“å­˜çš„ä¸æ˜¯è§†å›¾. å’Œ XmlViewResolver ä¸€æ ·, å®ƒä¹Ÿéœ€è¦æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å®šä¹‰é€»è¾‘è§†å›¾åç§°å’ŒçœŸæ­£çš„ View å¯¹è±¡çš„å¯¹åº”å…³ç³», ä¸åŒçš„æ˜¯ ResourceBundleViewResolver çš„é…ç½®æ–‡ä»¶æ˜¯ä¸€ä¸ªå±žæ€§æ–‡ä»¶, è€Œä¸”å¿…é¡»æ˜¯æ”¾åœ¨ classpath è·¯å¾„ä¸‹é¢çš„, é»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯åœ¨ classpath æ ¹ç›®å½•ä¸‹çš„ views.properties æ–‡ä»¶, å¦‚æžœä¸ä½¿ç”¨é»˜è®¤å€¼, åˆ™å¯ä»¥é€šè¿‡å±žæ€§ baseName æˆ– baseNames æ¥æŒ‡å®š. baseName R æ˜¯æŒ‡å®šä¸€ä¸ªåŸºåç§°, Spring ä¼šåœ¨æŒ‡å®šçš„ classpath æ ¹ç›®å½•ä¸‹å¯»æ‰¾å·²æŒ‡å®šçš„ baseName å¼€å§‹çš„å±žæ€§æ–‡ä»¶è¿›è¡Œ View è§£æž, å¦‚æŒ‡å®šçš„ baseName æ˜¯ base, é‚£ä¹ˆ base.properties, baseabc.properties ç­‰ä»¥ base å¼€å§‹çš„å±žæ€§æ–‡ä»¶éƒ½ä¼šè¢« Spring å½“åš ResourceBundleViewResolver è§£æžè§†å›¾çš„èµ„æºæ–‡ä»¶. ResourceBundleViewResolver ä½¿ç”¨çš„å±žæ€§é…ç½®æ–‡ä»¶çš„å†…å®¹ç±»ä¼¼äºŽè¿™æ ·:
</p>

<details id='orgeb6d2e7' class='code' open><summary><span class="lang">Configuration File</span></summary>
        <div class='gutter'>
        <a href='#orgeb6d2e7'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-conf"><span class="org-variable-name">resourceBundle.(class)</span>=org.springframework.web.servlet.view.InternalResourceView
<span class="org-variable-name">resourceBundle.url</span>=/index.jsp
<span class="org-variable-name">test.(class)</span>=org.springframework.web.servlet.view.InternalResourceView
<span class="org-variable-name">test.url</span>=/test.jsp
</pre>
</div>
        </details>

<p>
åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸¤ä¸ª InternalResourceView å¯¹è±¡, ä¸€ä¸ªåç§°æ˜¯ resourceBundle, å¯¹åº”çš„ URL æ˜¯ /index.jsp, å¦ä¸€ä¸ªåç§°æ˜¯ test, å¯¹åº”çš„ URL æ˜¯ /test.jsp. ä»Žè¿™ä¸ªå®šä¹‰å¯ä»¥çŸ¥é“, resourceBundle æ˜¯å¯¹åº”çš„è§†å›¾åç§°, ä½¿ç”¨ resourceBundle.(class) æ¥æŒ‡å®šå®ƒå¯¹åº”çš„è§†å›¾ç±»åž‹, resourceBundle.url æŒ‡å®šè¿™ä¸ªè§†å›¾çš„ URL å±žæ€§.
</p>

<p>
è¯»è€…å¯ä»¥çœ‹åˆ°, resourceBundle çš„ class å±žæ€§è¦ç”¨å°æ‹¬å·åŒ…èµ·æ¥, è€Œå®ƒçš„ URL å±žæ€§ä¸ºä»€ä¹ˆä¸éœ€è¦å‘¢ï¼Ÿè¿™å°±éœ€è¦ä»Ž ResourceBundleViewResolver è¿›è¡Œè§†å›¾è§£æžçš„æ–¹æ³•æ¥è¯´æ˜Ž. ResourceBundleViewResolver è¿˜æ˜¯é€šè¿‡ bean å·¥åŽ‚æ¥èŽ·å¾—å¯¹åº”è§†å›¾åç§°çš„è§†å›¾ bean å¯¹è±¡æ¥è§£æžè§†å›¾çš„, é‚£ä¹ˆè¿™äº› bean ä»Žå“ªé‡Œæ¥å‘¢ï¼Ÿå°±æ˜¯ä»Žå®šä¹‰çš„ properties å±žæ€§æ–‡ä»¶ä¸­æ¥. åœ¨ ResourceBundleViewResolver ç¬¬ä¸€æ¬¡è¿›è¡Œè§†å›¾è§£æžçš„æ—¶å€™ä¼šå…ˆ new ä¸€ä¸ª BeanFactory å¯¹è±¡, ç„¶åŽæŠŠ properties æ–‡ä»¶ä¸­å®šä¹‰å¥½çš„å±žæ€§æŒ‰ç…§å®ƒè‡ªèº«çš„è§„åˆ™ç”Ÿæˆä¸€ä¸ªä¸ªçš„ bean å¯¹è±¡æ³¨å†Œåˆ°è¯¥ BeanFactory ä¸­, ä¹‹åŽä¼šæŠŠè¯¥ BeanFactory å¯¹è±¡ä¿å­˜èµ·æ¥, æ‰€ä»¥ ResourceBundleViewResolver ç¼“å­˜çš„æ˜¯ BeanFactory, è€Œä¸æ˜¯ç›´æŽ¥ç¼“å­˜ä»Ž BeanFactory ä¸­å–å‡ºçš„è§†å›¾ bean. ç„¶åŽä¼šä»Ž bean å·¥åŽ‚ä¸­å–å‡ºåç§°ä¸ºé€»è¾‘è§†å›¾åç§°çš„è§†å›¾ bean è¿›è¡Œè¿”å›ž.
</p>

<p>
æŽ¥ä¸‹æ¥ä»‹ç» Spring é€šè¿‡ properties æ–‡ä»¶ç”Ÿæˆ bean çš„è§„åˆ™. å®ƒä¼šæŠŠ properties æ–‡ä»¶ä¸­å®šä¹‰çš„å±žæ€§åç§°æŒ‰æœ€åŽä¸€ä¸ªç‚¹è¿›è¡Œåˆ†å‰², æŠŠç‚¹å‰é¢çš„å†…å®¹å½“åšæ˜¯ bean åç§°, ç‚¹åŽé¢çš„å†…å®¹å½“åšæ˜¯ bean çš„å±žæ€§. è¿™å…¶ä¸­æœ‰å‡ ä¸ªç‰¹åˆ«çš„å±žæ€§, Spring æŠŠå®ƒä»¬ç”¨å°æ‹¬å·åŒ…èµ·æ¥äº†, è¿™äº›ç‰¹æ®Šçš„å±žæ€§ä¸€èˆ¬æ˜¯å¯¹åº”çš„ attribute, ä½†ä¸æ˜¯ bean å¯¹è±¡æ‰€æœ‰çš„ attribute éƒ½å¯ä»¥è¿™æ ·ç”¨. å…¶ä¸­(class) æ˜¯ä¸€ä¸ª, é™¤ T(class) ä¹‹å¤–, è¿˜æœ‰(scope),(parent),(abstract),(lazy-init). è€Œé™¤äº†è¿™äº›ç‰¹æ®Šçš„å±žæ€§ä¹‹å¤–çš„å…¶ä»–å±žæ€§, Spring ä¼šæŠŠå®ƒä»¬å½“åš bean å¯¹è±¡çš„ä¸€èˆ¬å±žæ€§è¿›è¡Œå¤„ç†, å°±æ˜¯ bean å¯¹è±¡å¯¹åº”çš„ propertyO æ‰€ä»¥æ ¹æ®ä¸Šé¢çš„å±žæ€§é…ç½®æ–‡ä»¶å°†ç”Ÿæˆå¦‚ä¸‹ä¸¤ä¸ª bean å¯¹è±¡:
</p>

<details id='org38c44f9' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org38c44f9'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"resourceBundle"</span>
      <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.BeanNameViewResolver"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/index.jsp"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">id</span>=<span class="org-string">"test"</span>
      <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.InternalResourceView"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"url"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/test.jsp"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
(8) FreeMarkerViewResolver
</p>

<p>
FreeMarkerViewResolver æ˜¯ UrlBasedViewResolver çš„ä¸€ä¸ªå­ç±», å®ƒä¼šæŠŠ Controller å¤„ç†æ–¹æ³•è¿”å›žçš„é€»è¾‘è§†å›¾è§£æžä¸º FreeMarkerViewo FreeMarkerViewResolver ä¼šæŒ‰ç…§ UrlBasedViewResolver æ‹¼æŽ¥ URL çš„æ–¹å¼è¿›è¡Œè§†å›¾è·¯å¾„çš„è§£æž, ä½†æ˜¯ä½¿ç”¨ FreeMarkerViewResolver çš„æ—¶å€™ä¸éœ€è¦æŒ‡å®šå…¶ viewClass, å› ä¸º FreeMarkerViewResolver ä¸­å·²ç»æŠŠ viewClass å®šæ­»ä¸º FreeMarkerView äº†. å…ˆåœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶é‡Œé¢å®šä¹‰ä¸€ä¸ª FreeMarkerViewResolver è§†å›¾è§£æžå™¨, å¹¶å®šä¹‰å…¶è§£æžè§†å›¾çš„ order é¡ºåºä¸º 1, ä»£ç ç¤ºä¾‹å¦‚ä¸‹:
</p>

<details id='org38bba53' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org38bba53'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span>
     <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver"</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"prefix"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"fm_"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"suffix"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">".ftl"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
    <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"order"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"1"</span><span class="org-nxml-tag-delimiter">&gt;&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">property</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>

<p>
å½“è¯·æ±‚çš„å¤„ç†å™¨æ–¹æ³•è¿”å›žä¸€ä¸ªé€»è¾‘è§†å›¾åç§° viewName çš„æ—¶å€™, å°±ä¼šè¢«è¯¥è§†å›¾å¤„ç†å™¨åŠ ä¸Šå‰åŽç¼€è§£æžä¸ºä¸€ä¸ª URL ä¸º &ldquo;fin_viewName.fU&rdquo; çš„ FreeMarkerView å¯¹è±¡. å¯¹äºŽ FreeMarkerView éœ€è¦ç»™å®šä¸€ä¸ª FreeMarkerConfig çš„ bean å¯¹è±¡æ¥å®šä¹‰ FreeMarker çš„é…ç½®ä¿¡æ¯. FreeMarkerConfig æ˜¯ä¸€ä¸ªæŽ¥å£, Spring å·²ç»æä¾›äº†ä¸€ä¸ªå®žçŽ°, å®ƒå°±æ˜¯ FreeMarkerConfigurer. å¯ä»¥é€šè¿‡åœ¨ Spring MVC çš„é…ç½®æ–‡ä»¶é‡Œå®šä¹‰è¯¥ bean å¯¹è±¡æ¥å®šä¹‰ FreeMarker çš„é…ç½®ä¿¡æ¯, è¯¥é…ç½®ä¿¡æ¯å°†ä¼šåœ¨ FreeMarkerView è¿›è¡Œæ¸²æŸ“çš„æ—¶å€™ä½¿ç”¨åˆ°. å¯¹äºŽ FreeMarkerConfigurer è€Œè¨€, æœ€ç®€å•çš„å°±æ˜¯é…ç½®ä¸€ä¸ª templateLoaderPath, å‘Šè¯‰ Spring åº”è¯¥åˆ°å“ªé‡Œå¯»æ‰¾ FreeMarker çš„æ¨¡æ¿æ–‡ä»¶. è¿™ä¸ª templateLoaderPath ä¹Ÿæ”¯æŒä½¿ç”¨ &ldquo;classpath:&rdquo; å’Œ &ldquo;file:&rdquo; å‰ç¼€. å½“ FreeMarker çš„æ¨¡æ¿æ–‡ä»¶æ”¾åœ¨å¤šä¸ªä¸åŒçš„è·¯å¾„ä¸‹é¢çš„æ—¶å€™, å¯ä»¥ä½¿ç”¨ templateLoaderPaths å±žæ€§æ¥æŒ‡å®šå¤šä¸ªè·¯å¾„. åœ¨è¿™é‡ŒæŒ‡å®šæ¨¡æ¿æ–‡ä»¶æ”¾åœ¨ &ldquo;/WEB-INF/fireemarker/template&rdquo; ä¸‹é¢, ç¤ºä¾‹ä»£ç å¦‚ä¸‹:
</p>

<details id='org75c8e34' class='code' open><summary><span class="lang">XML</span></summary>
        <div class='gutter'>
        <a href='#org75c8e34'>#</a>
        <button title='Copy to clipboard' onclick='copyPreToClipbord(this)'>âŽ˜</button>        </div>
        <div class="org-src-container">
<pre class="src src-xml"><span class="org-nxml-processing-instruction-delimiter">&lt;?</span><span class="org-nxml-processing-instruction-target">xml</span> <span class="org-nxml-processing-instruction-content">version="1.0" encoding="utf-8"</span><span class="org-nxml-processing-instruction-delimiter">?&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">bean</span> <span class="org-nxml-attribute-local-name">class</span>=<span class="org-string">"org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer"</span><span class="org-nxml-tag-delimiter">&gt;</span>
  <span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-element-local-name">property</span> <span class="org-nxml-attribute-local-name">name</span>=<span class="org-string">"templateLoaderPath"</span> <span class="org-nxml-attribute-local-name">value</span>=<span class="org-string">"/WEB-INF/freemarker/template"</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-tag-delimiter">&gt;</span>
<span class="org-nxml-tag-delimiter">&lt;</span><span class="org-nxml-tag-slash">/</span><span class="org-nxml-element-local-name">bean</span><span class="org-nxml-tag-delimiter">&gt;</span>
</pre>
</div>
        </details>
</div>
</div>

<div id="outline-container-orgbba9b9a" class="outline-3">
<h3 id="orgbba9b9a"><span class="section-number-3">3.4.</span> ViewResolver Chain</h3>
<div class="outline-text-3" id="text-3-4">
<p>
åœ¨ Spring MVC ä¸­å¯ä»¥åŒæ—¶å®šä¹‰å¤šä¸ª ViewResolver è§†å›¾è§£æžå™¨, ç„¶åŽå®ƒä»¬ä¼šç»„æˆä¸€ä¸ª ViewResolver é“¾. å½“ Controller å¤„ç†å™¨æ–¹æ³•è¿”å›žä¸€ä¸ªé€»è¾‘è§†å›¾åç§°åŽ ViewResolver é“¾å°†æ ¹æ®å…¶
</p>

<p>
ä¸­ ViewResolver çš„ä¼˜å…ˆçº§æ¥è¿›è¡Œå¤„ç†. æ‰€æœ‰çš„ ViewResolver éƒ½å®žçŽ°äº† Ordered æŽ¥å£, åœ¨ Spring ä¸­å®žçŽ°äº†è¿™ä¸ªæŽ¥å£çš„ç±»éƒ½æ˜¯å¯ä»¥æŽ’åºçš„. ViewResolver æ˜¯é€šè¿‡ order å±žæ€§æ¥æŒ‡å®šé¡ºåºçš„, é»˜è®¤éƒ½æ˜¯æœ€å¤§å€¼. æ‰€ä»¥å¯ä»¥é€šè¿‡æŒ‡å®š ViewResolver çš„ order å±žæ€§æ¥å®žçŽ° ViewResolver çš„ä¼˜å…ˆçº§, order å±žæ€§æ˜¯ Integer ç±»åž‹, order è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜, æ‰€ä»¥ç¬¬ä¸€ä¸ªè¿›è¡Œè§£æžçš„å°†æ˜¯ ViewResolver é“¾ä¸­ order å€¼æœ€å°çš„é‚£ä¸ª.
</p>

<p>
å¦‚æžœ ViewResolver è¿›è¡Œè§†å›¾è§£æžåŽè¿”å›žçš„ View å¯¹è±¡ä¸º null, åˆ™è¡¨ç¤º ViewResolver ä¸èƒ½è§£æžè¯¥è§†å›¾, è¿™ä¸ªæ—¶å€™å¦‚æžœè¿˜å­˜åœ¨å…¶ä»– order å€¼æ¯”å®ƒå¤§çš„ ViewResolver, å°±ä¼šè°ƒç”¨å‰©ä½™çš„ ViewResolver ä¸­ order å€¼æœ€å°çš„é‚£ä¸ªæ¥è§£æžè¯¥è§†å›¾, ä¾æ­¤ç±»æŽ¨. å½“ ViewResolver åœ¨è¿›è¡Œè§†å›¾è§£æžåŽè¿”å›žçš„æ˜¯ä¸€ä¸ªéžç©ºçš„ View å¯¹è±¡çš„æ—¶å€™, åˆ™è¡¨ç¤ºè¯¥ ViewResolver èƒ½å¤Ÿè§£æžè¯¥è§†å›¾, é‚£ä¹ˆè§†å›¾è§£æžå°±å®Œæˆäº†, åŽç»­çš„ ViewResolver å°†ä¸ä¼šå†ç”¨æ¥è§£æžè¯¥è§†å›¾. å½“å®šä¹‰çš„æ‰€æœ‰ ViewResolver éƒ½ä¸èƒ½è§£æžè¯¥è§†å›¾çš„æ—¶å€™, Spring å°±ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸.
</p>

<p>
åŸºäºŽ Spring æ”¯æŒçš„è¿™ç§ ViewResolver é“¾æ¨¡å¼, å°±å¯ä»¥åœ¨ Spring MVC åº”ç”¨ä¸­åŒæ—¶å®šä¹‰å¤šä¸ª ViewResolver, ç»™å®šä¸åŒçš„ order å€¼, è¿™æ ·å°±å¯ä»¥å¯¹ç‰¹å®šçš„è§†å›¾è¿›è¡Œå¤„ç†, ä»¥æ­¤æ¥æ”¯æŒåŒä¸€åº”ç”¨ä¸­æœ‰å¤šç§è§†å›¾ç±»åž‹.
</p>

<p>
åƒ InternalResourceViewResolver è¿™ç§èƒ½è§£æžæ‰€æœ‰çš„è§†å›¾, å³æ°¸è¿œèƒ½è¿”å›žä¸€ä¸ªéžç©º View å¯¹è±¡çš„ ViewResolver, ä¸€å®šè¦æŠŠå®ƒæ”¾åœ¨ ViewResolver é“¾çš„æœ€åŽé¢.
</p>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Luke Yao</p>
<p class="date">Created: 2022-10-09 Sun 18:20</p>
</div>
</div>
</body>
</html>
